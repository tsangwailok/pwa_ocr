var e=Object.create,t=Object.defineProperty,n=Object.getOwnPropertyDescriptor,r=Object.getOwnPropertyNames,i=Object.getPrototypeOf,a=Object.prototype.hasOwnProperty,o=(e,t)=>()=>(e&&(t=e(e=0)),t),s=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),c=(e,n)=>{let r={};for(var i in e)t(r,i,{get:e[i],enumerable:!0});return n||t(r,Symbol.toStringTag,{value:`Module`}),r},l=(e,i,o,s)=>{if(i&&typeof i==`object`||typeof i==`function`)for(var c=r(i),l=0,u=c.length,d;l<u;l++)d=c[l],!a.call(e,d)&&d!==o&&t(e,d,{get:(e=>i[e]).bind(null,d),enumerable:!(s=n(i,d))||s.enumerable});return e},u=(n,r,a)=>(a=n==null?{}:e(i(n)),l(r||!n||!n.__esModule?t(a,`default`,{value:n,enumerable:!0}):a,n)),d=e=>a.call(e,`module.exports`)?e[`module.exports`]:l(t({},`__esModule`,{value:!0}),e),f=(e=>typeof require<`u`?require:typeof Proxy<`u`?new Proxy(e,{get:(e,t)=>(typeof require<`u`?require:e)[t]}):e)(function(e){if(typeof require<`u`)return require.apply(this,arguments);throw Error('Calling `require` for "'+e+"\" in an environment that doesn't expose the `require` function. See https://rolldown.rs/in-depth/bundling-cjs#require-external-modules for more details.")});(function(){let e=document.createElement(`link`).relList;if(e&&e.supports&&e.supports(`modulepreload`))return;for(let e of document.querySelectorAll(`link[rel="modulepreload"]`))n(e);new MutationObserver(e=>{for(let t of e)if(t.type===`childList`)for(let e of t.addedNodes)e.tagName===`LINK`&&e.rel===`modulepreload`&&n(e)}).observe(document,{childList:!0,subtree:!0});function t(e){let t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),e.crossOrigin===`use-credentials`?t.credentials=`include`:e.crossOrigin===`anonymous`?t.credentials=`omit`:t.credentials=`same-origin`,t}function n(e){if(e.ep)return;e.ep=!0;let n=t(e);fetch(e.href,n)}})();var p=s(((e,t)=>{var n=function(e){var t=Object.prototype,n=t.hasOwnProperty,r=Object.defineProperty||function(e,t,n){e[t]=n.value},i,a=typeof Symbol==`function`?Symbol:{},o=a.iterator||`@@iterator`,s=a.asyncIterator||`@@asyncIterator`,c=a.toStringTag||`@@toStringTag`;function l(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},``)}catch{l=function(e,t,n){return e[t]=n}}function u(e,t,n,i){var a=t&&t.prototype instanceof _?t:_,o=Object.create(a.prototype);return r(o,`_invoke`,{value:E(e,n,new A(i||[]))}),o}e.wrap=u;function d(e,t,n){try{return{type:`normal`,arg:e.call(t,n)}}catch(e){return{type:`throw`,arg:e}}}var f=`suspendedStart`,p=`suspendedYield`,m=`executing`,h=`completed`,g={};function _(){}function v(){}function y(){}var b={};l(b,o,function(){return this});var x=Object.getPrototypeOf,S=x&&x(x(j([])));S&&S!==t&&n.call(S,o)&&(b=S);var C=y.prototype=_.prototype=Object.create(b);v.prototype=y,r(C,`constructor`,{value:y,configurable:!0}),r(y,`constructor`,{value:v,configurable:!0}),v.displayName=l(y,c,`GeneratorFunction`);function w(e){[`next`,`throw`,`return`].forEach(function(t){l(e,t,function(e){return this._invoke(t,e)})})}e.isGeneratorFunction=function(e){var t=typeof e==`function`&&e.constructor;return t?t===v||(t.displayName||t.name)===`GeneratorFunction`:!1},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,y):(e.__proto__=y,l(e,c,`GeneratorFunction`)),e.prototype=Object.create(C),e},e.awrap=function(e){return{__await:e}};function T(e,t){function i(r,a,o,s){var c=d(e[r],e,a);if(c.type===`throw`)s(c.arg);else{var l=c.arg,u=l.value;return u&&typeof u==`object`&&n.call(u,`__await`)?t.resolve(u.__await).then(function(e){i(`next`,e,o,s)},function(e){i(`throw`,e,o,s)}):t.resolve(u).then(function(e){l.value=e,o(l)},function(e){return i(`throw`,e,o,s)})}}var a;function o(e,n){function r(){return new t(function(t,r){i(e,n,t,r)})}return a=a?a.then(r,r):r()}r(this,`_invoke`,{value:o})}w(T.prototype),l(T.prototype,s,function(){return this}),e.AsyncIterator=T,e.async=function(t,n,r,i,a){a===void 0&&(a=Promise);var o=new T(u(t,n,r,i),a);return e.isGeneratorFunction(n)?o:o.next().then(function(e){return e.done?e.value:o.next()})};function E(e,t,n){var r=f;return function(i,a){if(r===m)throw Error(`Generator is already running`);if(r===h){if(i===`throw`)throw a;return M()}for(n.method=i,n.arg=a;;){var o=n.delegate;if(o){var s=D(o,n);if(s){if(s===g)continue;return s}}if(n.method===`next`)n.sent=n._sent=n.arg;else if(n.method===`throw`){if(r===f)throw r=h,n.arg;n.dispatchException(n.arg)}else n.method===`return`&&n.abrupt(`return`,n.arg);r=m;var c=d(e,t,n);if(c.type===`normal`){if(r=n.done?h:p,c.arg===g)continue;return{value:c.arg,done:n.done}}else c.type===`throw`&&(r=h,n.method=`throw`,n.arg=c.arg)}}}function D(e,t){var n=t.method,r=e.iterator[n];if(r===i)return t.delegate=null,n===`throw`&&e.iterator.return&&(t.method=`return`,t.arg=i,D(e,t),t.method===`throw`)||n!==`return`&&(t.method=`throw`,t.arg=TypeError(`The iterator does not provide a '`+n+`' method`)),g;var a=d(r,e.iterator,t.arg);if(a.type===`throw`)return t.method=`throw`,t.arg=a.arg,t.delegate=null,g;var o=a.arg;if(!o)return t.method=`throw`,t.arg=TypeError(`iterator result is not an object`),t.delegate=null,g;if(o.done)t[e.resultName]=o.value,t.next=e.nextLoc,t.method!==`return`&&(t.method=`next`,t.arg=i);else return o;return t.delegate=null,g}w(C),l(C,c,`Generator`),l(C,o,function(){return this}),l(C,`toString`,function(){return`[object Generator]`});function O(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function k(e){var t=e.completion||{};t.type=`normal`,delete t.arg,e.completion=t}function A(e){this.tryEntries=[{tryLoc:`root`}],e.forEach(O,this),this.reset(!0)}e.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}};function j(e){if(e){var t=e[o];if(t)return t.call(e);if(typeof e.next==`function`)return e;if(!isNaN(e.length)){var r=-1,a=function t(){for(;++r<e.length;)if(n.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=i,t.done=!0,t};return a.next=a}}return{next:M}}e.values=j;function M(){return{value:i,done:!0}}return A.prototype={constructor:A,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=i,this.done=!1,this.delegate=null,this.method=`next`,this.arg=i,this.tryEntries.forEach(k),!e)for(var t in this)t.charAt(0)===`t`&&n.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=i)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if(e.type===`throw`)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(n,r){return s.type=`throw`,s.arg=e,t.next=n,r&&(t.method=`next`,t.arg=i),!!r}for(var a=this.tryEntries.length-1;a>=0;--a){var o=this.tryEntries[a],s=o.completion;if(o.tryLoc===`root`)return r(`end`);if(o.tryLoc<=this.prev){var c=n.call(o,`catchLoc`),l=n.call(o,`finallyLoc`);if(c&&l){if(this.prev<o.catchLoc)return r(o.catchLoc,!0);if(this.prev<o.finallyLoc)return r(o.finallyLoc)}else if(c){if(this.prev<o.catchLoc)return r(o.catchLoc,!0)}else if(l){if(this.prev<o.finallyLoc)return r(o.finallyLoc)}else throw Error(`try statement without catch or finally`)}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,`finallyLoc`)&&this.prev<i.finallyLoc){var a=i;break}}a&&(e===`break`||e===`continue`)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var o=a?a.completion:{};return o.type=e,o.arg=t,a?(this.method=`next`,this.next=a.finallyLoc,g):this.complete(o)},complete:function(e,t){if(e.type===`throw`)throw e.arg;return e.type===`break`||e.type===`continue`?this.next=e.arg:e.type===`return`?(this.rval=this.arg=e.arg,this.method=`return`,this.next=`end`):e.type===`normal`&&t&&(this.next=t),g},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),k(n),g}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if(r.type===`throw`){var i=r.arg;k(n)}return i}}throw Error(`illegal catch attempt`)},delegateYield:function(e,t,n){return this.delegate={iterator:j(e),resultName:t,nextLoc:n},this.method===`next`&&(this.arg=i),g}},e}(typeof t==`object`?t.exports:{});try{regeneratorRuntime=n}catch{typeof globalThis==`object`?globalThis.regeneratorRuntime=n:Function(`r`,`regeneratorRuntime = r`)(n)}})),m=s(((e,t)=>{t.exports=(e,t)=>`${e}-${t}-${Math.random().toString(16).slice(3,8)}`})),h=s(((e,t)=>{var n=m(),r=0;t.exports=({id:e,action:t,payload:i={}})=>{let a=e;return a===void 0&&(a=n(`Job`,r),r+=1),{id:a,action:t,payload:i}}})),g=s((e=>{var t=!1;e.logging=t,e.setLogging=e=>{t=e},e.log=(...n)=>t?console.log.apply(e,n):null})),_=s(((e,t)=>{var n=h(),{log:r}=g(),i=m(),a=0;t.exports=()=>{let t=i(`Scheduler`,a),o={},s={},c=[];a+=1;let l=()=>c.length,u=()=>Object.keys(o).length,d=()=>{if(c.length!==0){let e=Object.keys(o);for(let t=0;t<e.length;t+=1)if(s[e[t]]===void 0){c[0](o[e[t]]);break}}},f=(i,a)=>new Promise((o,l)=>{let u=n({action:i,payload:a});c.push(async t=>{c.shift(),s[t.id]=u;try{o(await t[i].apply(e,[...a,u.id]))}catch(e){l(e)}finally{delete s[t.id],d()}}),r(`[${t}]: Add ${u.id} to JobQueue`),r(`[${t}]: JobQueue length=${c.length}`),d()});return{addWorker:e=>(o[e.id]=e,r(`[${t}]: Add ${e.id}`),r(`[${t}]: Number of workers=${u()}`),d(),e.id),addJob:async(e,...n)=>{if(u()===0)throw Error(`[${t}]: You need to have at least one worker before adding jobs`);return f(e,n)},terminate:async()=>{Object.keys(o).forEach(async e=>{await o[e].terminate()}),c=[]},getQueueLen:l,getNumWorkers:u}}})),v=s(((e,t)=>{t.exports=e=>{let t={};return typeof WorkerGlobalScope<`u`?t.type=`webworker`:typeof document==`object`?t.type=`browser`:typeof process==`object`&&typeof f==`function`&&(t.type=`node`),e===void 0?t:t[e]}})),y=s(((e,t)=>{var n=v()(`type`)===`browser`?e=>new URL(e,window.location.href).href:e=>e;t.exports=e=>{let t={...e};return[`corePath`,`workerPath`,`langPath`].forEach(r=>{e[r]&&(t[r]=n(t[r]))}),t}})),b=s(((e,t)=>{t.exports={TESSERACT_ONLY:0,LSTM_ONLY:1,TESSERACT_LSTM_COMBINED:2,DEFAULT:3}})),x=c({author:()=>``,browser:()=>j,bugs:()=>R,collective:()=>B,contributors:()=>M,default:()=>V,dependencies:()=>F,description:()=>w,devDependencies:()=>P,homepage:()=>z,jsdelivr:()=>k,license:()=>N,main:()=>T,name:()=>S,overrides:()=>I,repository:()=>L,scripts:()=>A,type:()=>E,types:()=>D,unpkg:()=>O,version:()=>C}),S,C,w,T,E,D,O,k,A,j,M,N,P,F,I,L,R,z,B,V,H=o((()=>{S=`tesseract.js`,C=`7.0.0`,w=`Pure Javascript Multilingual OCR`,T=`src/index.js`,E=`commonjs`,D=`src/index.d.ts`,O=`dist/tesseract.min.js`,k=`dist/tesseract.min.js`,A={start:`node scripts/server.js`,build:`rimraf dist && webpack --config scripts/webpack.config.prod.js && rollup -c scripts/rollup.esm.mjs`,"profile:tesseract":`webpack-bundle-analyzer dist/tesseract-stats.json`,"profile:worker":`webpack-bundle-analyzer dist/worker-stats.json`,prepublishOnly:`npm run build`,wait:`rimraf dist && wait-on http://localhost:3000/dist/tesseract.min.js`,test:`npm-run-all -p -r start test:all`,"test:all":`npm-run-all wait test:browser test:node:all`,"test:browser":`karma start karma.conf.js`,"test:node":`nyc mocha --exit --bail --require ./scripts/test-helper.mjs`,"test:node:all":`npm run test:node -- ./tests/*.test.mjs`,lint:`eslint src`,"lint:fix":`eslint --fix src`,postinstall:`opencollective-postinstall || true`},j={"./src/worker/node/index.js":`./src/worker/browser/index.js`},M=[`jeromewu`],N=`Apache-2.0`,P={"@babel/core":`^7.21.4`,"@babel/eslint-parser":`^7.21.3`,"@babel/preset-env":`^7.21.4`,"@rollup/plugin-commonjs":`^24.1.0`,acorn:`^8.8.2`,"babel-loader":`^9.1.2`,buffer:`^6.0.3`,cors:`^2.8.5`,eslint:`^7.32.0`,"eslint-config-airbnb-base":`^14.2.1`,"eslint-plugin-import":`^2.27.5`,"expect.js":`^0.3.1`,express:`^4.18.2`,mocha:`^10.2.0`,"npm-run-all":`^4.1.5`,karma:`^6.4.2`,"karma-chrome-launcher":`^3.2.0`,"karma-firefox-launcher":`^2.1.2`,"karma-mocha":`^2.0.1`,"karma-webpack":`^5.0.0`,nyc:`^15.1.0`,rimraf:`^5.0.0`,rollup:`^3.20.7`,"wait-on":`^7.0.1`,webpack:`^5.79.0`,"webpack-bundle-analyzer":`^4.8.0`,"webpack-cli":`^5.0.1`,"webpack-dev-middleware":`^6.0.2`,"rollup-plugin-sourcemaps":`^0.6.3`},F={"bmp-js":`^0.1.0`,"idb-keyval":`^6.2.0`,"is-url":`^1.2.4`,"node-fetch":`^2.6.9`,"opencollective-postinstall":`^2.0.3`,"regenerator-runtime":`^0.13.3`,"tesseract.js-core":`^7.0.0`,"wasm-feature-detect":`^1.8.0`,zlibjs:`^0.3.1`},I={"@rollup/pluginutils":`^5.0.2`},L={type:`git`,url:`https://github.com/naptha/tesseract.js.git`},R={url:`https://github.com/naptha/tesseract.js/issues`},z=`https://github.com/naptha/tesseract.js`,B={type:`opencollective`,url:`https://opencollective.com/tesseractjs`},V={name:S,version:C,description:w,main:T,type:E,types:D,unpkg:O,jsdelivr:k,scripts:A,browser:j,author:``,contributors:M,license:N,devDependencies:P,dependencies:F,overrides:I,repository:L,bugs:R,homepage:z,collective:B}})),U=s(((e,t)=>{t.exports={workerBlobURL:!0,logger:()=>{}}})),W=s(((e,t)=>{var n=(H(),d(x).default).version;t.exports={...U(),workerPath:`https://cdn.jsdelivr.net/npm/tesseract.js@v${n}/dist/worker.min.js`}})),G=s(((e,t)=>{t.exports=({workerPath:e,workerBlobURL:t})=>{let n;if(Blob&&URL&&t){let t=new Blob([`importScripts("${e}");`],{type:`application/javascript`});n=new Worker(URL.createObjectURL(t))}else n=new Worker(e);return n}})),K=s(((e,t)=>{t.exports=e=>{e.terminate()}})),ee=s(((e,t)=>{t.exports=(e,t)=>{e.onmessage=({data:e})=>{t(e)}}})),q=s(((e,t)=>{t.exports=async(e,t)=>{e.postMessage(t)}})),te=s(((e,t)=>{var n=e=>new Promise((t,n)=>{let r=new FileReader;r.onload=()=>{t(r.result)},r.onerror=({target:{error:{code:e}}})=>{n(Error(`File could not be read! Code=${e}`))},r.readAsArrayBuffer(e)}),r=async e=>{let t=e;return e===void 0?`undefined`:(typeof e==`string`?t=/data:image\/([a-zA-Z]*);base64,([^"]*)/.test(e)?atob(e.split(`,`)[1]).split(``).map(e=>e.charCodeAt(0)):await(await fetch(e)).arrayBuffer():typeof HTMLElement<`u`&&e instanceof HTMLElement?(e.tagName===`IMG`&&(t=await r(e.src)),e.tagName===`VIDEO`&&(t=await r(e.poster)),e.tagName===`CANVAS`&&await new Promise(r=>{e.toBlob(async e=>{t=await n(e),r()})})):typeof OffscreenCanvas<`u`&&e instanceof OffscreenCanvas?t=await n(await e.convertToBlob()):(e instanceof File||e instanceof Blob)&&(t=await n(e)),new Uint8Array(t))};t.exports=r})),ne=s(((e,t)=>{t.exports={defaultOptions:W(),spawnWorker:G(),terminateWorker:K(),onMessage:ee(),send:q(),loadImage:te()}})),re=s(((e,t)=>{var n=y(),r=h(),{log:i}=g(),a=m(),o=b(),{defaultOptions:s,spawnWorker:c,terminateWorker:l,onMessage:u,loadImage:d,send:f}=ne(),p=0;t.exports=async(e=`eng`,t=o.LSTM_ONLY,m={},h={})=>{let g=a(`Worker`,p),{logger:_,errorHandler:v,...y}=n({...s,...m}),b={},x=typeof e==`string`?e.split(`+`):e,S=t,C=h,w=[o.DEFAULT,o.LSTM_ONLY].includes(t)&&!y.legacyCore,T,E,D=new Promise((e,t)=>{E=e,T=t}),O=e=>{T(e.message)},k=c(y);k.onerror=O,p+=1;let A=({id:e,action:t,payload:n})=>new Promise((r,a)=>{i(`[${g}]: Start ${e}, action=${t}`);let o=`${t}-${e}`;b[o]={resolve:r,reject:a},f(k,{workerId:g,jobId:e,action:t,payload:n})}),j=()=>console.warn("`load` is depreciated and should be removed from code (workers now come pre-loaded)"),M=e=>A(r({id:e,action:`load`,payload:{options:{lstmOnly:w,corePath:y.corePath,logging:y.logging}}})),N=(e,t,n)=>A(r({id:n,action:`FS`,payload:{method:`writeFile`,args:[e,t]}})),P=(e,t)=>A(r({id:t,action:`FS`,payload:{method:`readFile`,args:[e,{encoding:`utf8`}]}})),F=(e,t)=>A(r({id:t,action:`FS`,payload:{method:`unlink`,args:[e]}})),I=(e,t,n)=>A(r({id:n,action:`FS`,payload:{method:e,args:t}})),L=(e,t)=>A(r({id:t,action:`loadLanguage`,payload:{langs:e,options:{langPath:y.langPath,dataPath:y.dataPath,cachePath:y.cachePath,cacheMethod:y.cacheMethod,gzip:y.gzip,lstmOnly:[o.DEFAULT,o.LSTM_ONLY].includes(S)&&!y.legacyLang}}})),R=(e,t,n,i)=>A(r({id:i,action:`initialize`,payload:{langs:e,oem:t,config:n}})),z=(e=`eng`,t,n,r)=>{if(w&&[o.TESSERACT_ONLY,o.TESSERACT_LSTM_COMBINED].includes(t))throw Error(`Legacy model requested but code missing.`);let i=t||S;S=i;let a=n||C;C=a;let s=(typeof e==`string`?e.split(`+`):e).filter(e=>!x.includes(e));return x.push(...s),s.length>0?L(s,r).then(()=>R(e,i,a,r)):R(e,i,a,r)},B=(e={},t)=>A(r({id:t,action:`setParameters`,payload:{params:e}})),V=async(e,t={},n={text:!0},i)=>A(r({id:i,action:`recognize`,payload:{image:await d(e),options:t,output:n}})),H=async(e,t)=>{if(w)throw Error("`worker.detect` requires Legacy model, which was not loaded.");return A(r({id:t,action:`detect`,payload:{image:await d(e)}}))},U=async()=>(k!==null&&(l(k),k=null),Promise.resolve());u(k,({workerId:e,jobId:t,status:n,action:r,data:a})=>{let o=`${r}-${t}`;if(n===`resolve`)i(`[${e}]: Complete ${t}`),b[o].resolve({jobId:t,data:a}),delete b[o];else if(n===`reject`)if(b[o].reject(a),delete b[o],r===`load`&&T(a),v)v(a);else throw Error(a);else n===`progress`&&_({...a,userJobId:t})});let W={id:g,worker:k,load:j,writeText:N,readText:P,removeFile:F,FS:I,reinitialize:z,setParameters:B,recognize:V,detect:H,terminate:U};return M().then(()=>L(e)).then(()=>R(e,t,h)).then(()=>E(W)).catch(()=>{}),D}})),ie=s(((e,t)=>{var n=re();t.exports={recognize:async(e,t,r)=>{let i=await n(t,1,r);return i.recognize(e).finally(async()=>{await i.terminate()})},detect:async(e,t)=>{let r=await n(`osd`,0,t);return r.detect(e).finally(async()=>{await r.terminate()})}}})),J=s(((e,t)=>{t.exports={AFR:`afr`,AMH:`amh`,ARA:`ara`,ASM:`asm`,AZE:`aze`,AZE_CYRL:`aze_cyrl`,BEL:`bel`,BEN:`ben`,BOD:`bod`,BOS:`bos`,BUL:`bul`,CAT:`cat`,CEB:`ceb`,CES:`ces`,CHI_SIM:`chi_sim`,CHI_TRA:`chi_tra`,CHR:`chr`,CYM:`cym`,DAN:`dan`,DEU:`deu`,DZO:`dzo`,ELL:`ell`,ENG:`eng`,ENM:`enm`,EPO:`epo`,EST:`est`,EUS:`eus`,FAS:`fas`,FIN:`fin`,FRA:`fra`,FRK:`frk`,FRM:`frm`,GLE:`gle`,GLG:`glg`,GRC:`grc`,GUJ:`guj`,HAT:`hat`,HEB:`heb`,HIN:`hin`,HRV:`hrv`,HUN:`hun`,IKU:`iku`,IND:`ind`,ISL:`isl`,ITA:`ita`,ITA_OLD:`ita_old`,JAV:`jav`,JPN:`jpn`,KAN:`kan`,KAT:`kat`,KAT_OLD:`kat_old`,KAZ:`kaz`,KHM:`khm`,KIR:`kir`,KOR:`kor`,KUR:`kur`,LAO:`lao`,LAT:`lat`,LAV:`lav`,LIT:`lit`,MAL:`mal`,MAR:`mar`,MKD:`mkd`,MLT:`mlt`,MSA:`msa`,MYA:`mya`,NEP:`nep`,NLD:`nld`,NOR:`nor`,ORI:`ori`,PAN:`pan`,POL:`pol`,POR:`por`,PUS:`pus`,RON:`ron`,RUS:`rus`,SAN:`san`,SIN:`sin`,SLK:`slk`,SLV:`slv`,SPA:`spa`,SPA_OLD:`spa_old`,SQI:`sqi`,SRP:`srp`,SRP_LATN:`srp_latn`,SWA:`swa`,SWE:`swe`,SYR:`syr`,TAM:`tam`,TEL:`tel`,TGK:`tgk`,TGL:`tgl`,THA:`tha`,TIR:`tir`,TUR:`tur`,UIG:`uig`,UKR:`ukr`,URD:`urd`,UZB:`uzb`,UZB_CYRL:`uzb_cyrl`,VIE:`vie`,YID:`yid`}})),ae=s(((e,t)=>{t.exports={OSD_ONLY:`0`,AUTO_OSD:`1`,AUTO_ONLY:`2`,AUTO:`3`,SINGLE_COLUMN:`4`,SINGLE_BLOCK_VERT_TEXT:`5`,SINGLE_BLOCK:`6`,SINGLE_LINE:`7`,SINGLE_WORD:`8`,CIRCLE_WORD:`9`,SINGLE_CHAR:`10`,SPARSE_TEXT:`11`,SPARSE_TEXT_OSD:`12`,RAW_LINE:`13`}})),oe=s(((e,t)=>{p();var n=_(),r=re(),i=ie(),a=J(),o=b(),s=ae(),{setLogging:c}=g();t.exports={languages:a,OEM:o,PSM:s,createScheduler:n,createWorker:r,setLogging:c,...i}})),se=s(((e,t)=>{var n=n||{REVISION:`ALPHA`};(function(e){var t=1.192092896e-7,r=1e-37,i=256,a=512,o=1024,s=2048,c=4096,l=1,u=2,d=3,f=4,p=new Int32Array([-1,1,4,-1,4,-1,-1,-1,8,-1,-1,-1,-1,-1,-1,-1,8]),m=(function(){return function(e){return e&65280}})(),h=(function(){return function(e){return e&255}})(),g=(function(){return function(e){return p[(e&65280)>>8]}})(),_=0,v=1,y=2,b=3,x=1,S=1,C=2,w=(function(){function e(e,t){this.size=(e+7|0)&-8,t===void 0?this.buffer=new ArrayBuffer(this.size):(this.buffer=t,this.size=t.length),this.u8=new Uint8Array(this.buffer),this.i32=new Int32Array(this.buffer),this.f32=new Float32Array(this.buffer),this.f64=new Float64Array(this.buffer)}return e})(),T=(function(){function e(e,t,n,r){this.type=m(n)|0,this.channel=h(n)|0,this.cols=e|0,this.rows=t|0,r===void 0?this.allocate():(this.buffer=r,this.data=this.type&i?this.buffer.u8:this.type&a?this.buffer.i32:this.type&o?this.buffer.f32:this.buffer.f64)}return e.prototype.allocate=function(){delete this.data,delete this.buffer,this.buffer=new w(this.cols*g(this.type)*this.channel*this.rows),this.data=this.type&i?this.buffer.u8:this.type&a?this.buffer.i32:this.type&o?this.buffer.f32:this.buffer.f64},e.prototype.copy_to=function(e){for(var t=e.data,n=this.data,r=0,i=this.cols*this.rows*this.channel|0;r<i-4;r+=4)t[r]=n[r],t[r+1]=n[r+1],t[r+2]=n[r+2],t[r+3]=n[r+3];for(;r<i;++r)t[r]=n[r]},e.prototype.resize=function(e,t,n){n===void 0&&(n=this.channel),e*g(this.type)*n*t>this.buffer.size?(this.cols=e,this.rows=t,this.channel=n,this.allocate()):(this.cols=e,this.rows=t,this.channel=n)},e})(),E=(function(){function e(e){this.levels=e|0,this.data=Array(e),this.pyrdown=n.imgproc.pyrdown}return e.prototype.allocate=function(e,t,n){for(var r=this.levels;--r>=0;)this.data[r]=new T(e>>r,t>>r,n)},e.prototype.build=function(e,t){t===void 0&&(t=!0);var n=2,r=e,i=this.data[0];if(!t)for(var a=e.cols*e.rows;--a>=0;)i.data[a]=e.data[a];for(i=this.data[1],this.pyrdown(r,i);n<this.levels;++n)r=i,i=this.data[n],this.pyrdown(r,i)},e})(),D=(function(){function e(e,t,n,r,i){e===void 0&&(e=0),t===void 0&&(t=0),n===void 0&&(n=0),r===void 0&&(r=0),i===void 0&&(i=-1),this.x=e,this.y=t,this.score=n,this.level=r,this.angle=i}return e})();e.U8_t=i,e.S32_t=a,e.F32_t=o,e.S64_t=s,e.F64_t=c,e.C1_t=l,e.C2_t=u,e.C3_t=d,e.C4_t=f,e.U8C1_t=i|l,e.U8C3_t=i|d,e.U8C4_t=i|f,e.F32C1_t=o|l,e.F32C2_t=o|u,e.S32C1_t=a|l,e.S32C2_t=a|u,e.EPSILON=t,e.FLT_MIN=r,e.COLOR_RGBA2GRAY=_,e.COLOR_RGB2GRAY=v,e.COLOR_BGRA2GRAY=y,e.COLOR_BGR2GRAY=b,e.BOX_BLUR_NOSCALE=x,e.SVD_U_T=S,e.SVD_V_T=C,e.get_data_type=m,e.get_channel=h,e.get_data_type_size=g,e.data_t=w,e.matrix_t=T,e.pyramid_t=E,e.keypoint_t=D})(n),(function(e){var t=(function(){var e=(function(){function e(e){this.next=null,this.data=new n.data_t(e),this.size=this.data.size,this.buffer=this.data.buffer,this.u8=this.data.u8,this.i32=this.data.i32,this.f32=this.data.f32,this.f64=this.data.f64}return e.prototype.resize=function(e){delete this.data,this.data=new n.data_t(e),this.size=this.data.size,this.buffer=this.data.buffer,this.u8=this.data.u8,this.i32=this.data.i32,this.f32=this.data.f32,this.f64=this.data.f64},e})(),t,r,i=0;return{allocate:function(n,a){t=r=new e(a);for(var o=0;o<n;++o){var s=new e(a);r=r.next=s,i++}},get_buffer:function(e){var n=t;return t=t.next,i--,e>n.size&&n.resize(e),n},put_buffer:function(e){r=r.next=e,i++}}})();e.cache=t,t.allocate(30,640*4)})(n),(function(e){e.math=(function(){var e=new Int32Array(96);return{get_gaussian_kernel:function(e,t,r,i){var a=0,o=0,s=0,c=0,l=0,u=0,d=n.cache.get_buffer(e<<2),f=d.f32;if((e&1)==1&&e<=7&&t<=0)switch(e>>1){case 0:f[0]=1,u=1;break;case 1:f[0]=.25,f[1]=.5,f[2]=.25,u=1;break;case 2:f[0]=.0625,f[1]=.25,f[2]=.375,f[3]=.25,f[4]=.0625,u=1;break;case 3:f[0]=.03125,f[1]=.109375,f[2]=.21875,f[3]=.28125,f[4]=.21875,f[5]=.109375,f[6]=.03125,u=1;break}else for(c=t>0?t:((e-1)*.5-1)*.3+.8,l=-.5/(c*c);a<e;++a)o=a-(e-1)*.5,s=Math.exp(l*o*o),f[a]=s,u+=s;if(i&n.U8_t)for(u=256/u,a=0;a<e;++a)r[a]=f[a]*u+.5|0;else for(u=1/u,a=0;a<e;++a)r[a]=f[a]*u;n.cache.put_buffer(d)},perspective_4point_transform:function(e,t,n,r,i,a,o,s,c,l,u,d,f,p,m,h,g){var _=t,v=l,y=o,b=_*v*y,x=m,S=_*x,C=v*S,w=u,T=_*w,E=a,D=n,O=p,k=D*O,A=k*E,j=O*E*w,M=O*y,N=O*w,P=v*y,F=x*v,I=x*E,L=w*E,R=1/(M-N-P+F-I+L),z=_*O,B=D*E,V=y*_,H=x*V,U=D*v,W=k*w,G=D*w*E,K=y*x*v,ee=x*D,q=-(C-b+T*E-E*S-k*v+A-j+M*v)*R,te=(b-C-z*y+z*w+A-v*B+I*v-j)*R,ne=_,re=(-w*S+H+U*y-k*y+W-G+I*w-K)*R,ie=(-H+V*w-ee*v+W-G+ee*E+K-M*w)*R,J=D,ae=(-T+V+U-B+N-M-F+I)*R,oe=(-S+T+k-U+I-L-M+P)*R;_=r,v=d,y=c,b=_*v*y,x=g,S=_*x,C=v*S,w=f,T=_*w,E=s,D=i,O=h,k=D*O,A=k*E,j=O*E*w,M=O*y,N=O*w,P=v*y,F=x*v,I=x*E,L=w*E,R=1/(M-N-P+F-I+L),z=_*O,B=D*E,V=y*_,H=x*V,U=D*v,W=k*w,G=D*w*E,K=y*x*v,ee=x*D;var se=-(C-b+T*E-E*S-k*v+A-j+M*v)*R,ce=(b-C-z*y+z*w+A-v*B+I*v-j)*R,le=_,ue=(-w*S+H+U*y-k*y+W-G+I*w-K)*R,Y=(-H+V*w-ee*v+W-G+ee*E+K-M*w)*R,X=D,de=(-T+V+U-B+N-M-F+I)*R,Z=(-S+T+k-U+I-L-M+P)*R;v=ie-oe*J,y=q*ie,b=q*J,S=re*te,C=ne*re,T=te*ae;var Q=ne*ae;O=1/(y-b*oe-S+C*oe+T*J-Q*ie),A=-re+J*ae;var fe=-re*oe+ie*ae;L=-te+ne*oe;var pe=q-Q;B=q*oe-T,V=-te*J+ne*ie;var me=b-C,he=y-S;G=v*O;var ge=L*O,_e=V*O,$=e.data;$[0]=se*G+A*O*ce-fe*O*le,$[1]=se*ge+pe*O*ce-B*O*le,$[2]=-se*_e-me*O*ce+he*O*le,$[3]=ue*G+A*O*Y-fe*O*X,$[4]=ue*ge+pe*O*Y-B*O*X,$[5]=-ue*_e-me*O*Y+he*O*X,$[6]=de*G+A*O*Z-fe*O,$[7]=de*ge+pe*O*Z-B*O,$[8]=-de*_e-me*O*Z+he*O},qsort:function(t,n,r,i){var a=7,o,s,c,l,u=0,d=0,f=0,p=0,m=0,h=0,g=0,_=0,v=0,y=0,b=0,x=0,S=0,C=0,w=0,T=0,E=0,D=0,O=e;if(!(r-n+1<=1))for(O[0]=n,O[1]=r;u>=0;)for(d=O[u<<1],f=O[(u<<1)+1],u--;;)if(m=f-d+1,m<=a){for(g=d+1;g<=f;g++)for(_=g;_>d&&i(t[_],t[_-1]);_--)o=t[_],t[_]=t[_-1],t[_-1]=o;break}else{for(D=0,y=d,x=f,C=d+(m>>1),m>40&&(v=m>>3,w=d,T=d+v,E=d+(v<<1),s=t[w],c=t[T],l=t[E],d=i(s,c)?i(c,l)?T:i(s,l)?E:w:i(l,c)?T:i(s,l)?w:E,w=C-v,T=C,E=C+v,s=t[w],c=t[T],l=t[E],C=i(s,c)?i(c,l)?T:i(s,l)?E:w:i(l,c)?T:i(s,l)?w:E,w=f-(v<<1),T=f-v,E=f,s=t[w],c=t[T],l=t[E],f=i(s,c)?i(c,l)?T:i(s,l)?E:w:i(l,c)?T:i(s,l)?w:E),w=d,T=C,E=f,s=t[w],c=t[T],l=t[E],C=i(s,c)?i(c,l)?T:i(s,l)?E:w:i(l,c)?T:i(s,l)?w:E,C!=y&&(o=t[C],t[C]=t[y],t[y]=o,C=y),d=b=y+1,f=S=x,s=t[C];;){for(;d<=f&&!i(s,t[d]);)i(t[d],s)||(d>b&&(o=t[b],t[b]=t[d],t[d]=o),D=1,b++),d++;for(;d<=f&&!i(t[f],s);)i(s,t[f])||(f<S&&(o=t[S],t[S]=t[f],t[f]=o),D=1,S--),f--;if(d>f)break;o=t[d],t[d]=t[f],t[f]=o,D=1,d++,f--}if(D==0){for(d=y,f=x,g=d+1;g<=f;g++)for(_=g;_>d&&i(t[_],t[_-1]);_--)o=t[_],t[_]=t[_-1],t[_-1]=o;break}for(m=Math.min(b-y,d-b),h=d-m|0,p=0;p<m;++p,++h)o=t[y+p],t[y+p]=t[h],t[h]=o;for(m=Math.min(x-S,S-f),h=x-m+1|0,p=0;p<m;++p,++h)o=t[d+p],t[d+p]=t[h],t[h]=o;if(m=d-b,h=S-f,m>1)h>1?m>h?(++u,O[u<<1]=y,O[(u<<1)+1]=y+m-1,d=x-h+1,f=x):(++u,O[u<<1]=x-h+1,O[(u<<1)+1]=x,d=y,f=y+m-1):(d=y,f=y+m-1);else if(h>1)d=x-h+1,f=x;else break}},median:function(e,t,n){for(var r,i=0,a=0,o=0,s=t+n>>1;;){if(n<=t)return e[s];if(n==t+1)return e[t]>e[n]&&(r=e[t],e[t]=e[n],e[n]=r),e[s];for(i=t+n>>1,e[i]>e[n]&&(r=e[i],e[i]=e[n],e[n]=r),e[t]>e[n]&&(r=e[t],e[t]=e[n],e[n]=r),e[i]>e[t]&&(r=e[i],e[i]=e[t],e[t]=r),a=t+1,r=e[i],e[i]=e[a],e[a]=r,o=n;;){do++a;while(e[t]>e[a]);do--o;while(e[o]>e[t]);if(o<a)break;r=e[a],e[a]=e[o],e[o]=r}r=e[t],e[t]=e[o],e[o]=r,o<=s?t=a:o>=s&&(n=o-1)}return 0}}})()})(n),(function(e){e.matmath=(function(){return{identity:function(e,t){t===void 0&&(t=1);for(var n=e.data,r=e.rows,i=e.cols,a=i+1|0,o=r*i,s=o;--o>=0;)n[o]=0;for(o=s,s=0;s<o;)n[s]=t,s+=a},transpose:function(e,t){for(var n=0,r=0,i=t.rows,a=t.cols,o=0,s=0,c=0,l=t.data,u=e.data;n<i;s+=1,o+=a,n++)for(c=s,r=0;r<a;c+=i,r++)u[c]=l[o+r]},multiply:function(e,t,n){for(var r=0,i=0,a=0,o=0,s=0,c=0,l=0,u=0,d=t.cols,f=t.rows,p=n.cols,m=t.data,h=n.data,g=e.data,_=0;r<f;o+=d,r++)for(l=0,i=0;i<p;u++,l++,i++){for(c=l,s=o,_=0,a=0;a<d;s++,c+=p,a++)_+=m[s]*h[c];g[u]=_}},multiply_ABt:function(e,t,n){for(var r=0,i=0,a=0,o=0,s=0,c=0,l=0,u=t.cols,d=t.rows,f=n.rows,p=t.data,m=n.data,h=e.data,g=0;r<d;o+=u,r++)for(c=0,i=0;i<f;l++,i++){for(s=o,g=0,a=0;a<u;s++,c++,a++)g+=p[s]*m[c];h[l]=g}},multiply_AtB:function(e,t,n){for(var r=0,i=0,a=0,o=0,s=0,c=0,l=0,u=0,d=t.cols,f=t.rows,p=n.cols,m=t.data,h=n.data,g=e.data,_=0;r<d;o++,r++)for(l=0,i=0;i<p;u++,l++,i++){for(c=l,s=o,_=0,a=0;a<f;s+=d,c+=p,a++)_+=m[s]*h[c];g[u]=_}},multiply_AAt:function(e,t){for(var n=0,r=0,i=0,a=0,o=0,s=0,c=0,l=0,u=0,d=t.cols,f=t.rows,p=t.data,m=e.data,h=0;n<f;a+=f+1,o=s,n++)for(l=a,u=a,c=o,r=n;r<f;l++,u+=f,r++){for(s=o,h=0,i=0;i<d;i++)h+=p[s++]*p[c++];m[l]=h,m[u]=h}},multiply_AtA:function(e,t){for(var n=0,r=0,i=0,a=0,o=0,s=0,c=0,l=0,u=0,d=t.cols,f=t.rows,p=t.data,m=e.data,h=0;n<d;c+=d,n++)for(a=n,u=c+n,l=u,r=n;r<d;l++,u+=d,r++){for(o=a,s=r,h=0,i=0;i<f;o+=d,s+=d,i++)h+=p[o]*p[s];m[l]=h,m[u]=h}},identity_3x3:function(e,t){t===void 0&&(t=1);var n=e.data;n[0]=n[4]=n[8]=t,n[1]=n[2]=n[3]=0,n[5]=n[6]=n[7]=0},invert_3x3:function(e,t){var n=e.data,r=t.data,i=n[4],a=n[8],o=n[5],s=n[7],c=n[0],l=c*i,u=c*o,d=n[3],f=n[1],p=d*f,m=n[2],h=d*m,g=n[6],_=g*f,v=g*m,y=1/(l*a-u*s-p*a+h*s+_*o-v*i);r[0]=(i*a-o*s)*y,r[1]=-(f*a-m*s)*y,r[2]=-(-f*o+m*i)*y,r[3]=-(d*a-o*g)*y,r[4]=(c*a-v)*y,r[5]=-(u-h)*y,r[6]=-(-d*s+i*g)*y,r[7]=-(c*s-_)*y,r[8]=(l-p)*y},multiply_3x3:function(e,t,n){var r=e.data,i=t.data,a=n.data,o=i[0],s=i[1],c=i[2],l=i[3],u=i[4],d=i[5],f=i[6],p=i[7],m=i[8],h=a[0],g=a[1],_=a[2],v=a[3],y=a[4],b=a[5],x=a[6],S=a[7],C=a[8];r[0]=o*h+s*v+c*x,r[1]=o*g+s*y+c*S,r[2]=o*_+s*b+c*C,r[3]=l*h+u*v+d*x,r[4]=l*g+u*y+d*S,r[5]=l*_+u*b+d*C,r[6]=f*h+p*v+m*x,r[7]=f*g+p*y+m*S,r[8]=f*_+p*b+m*C},mat3x3_determinant:function(e){var t=e.data;return t[0]*t[4]*t[8]-t[0]*t[5]*t[7]-t[3]*t[1]*t[8]+t[3]*t[2]*t[7]+t[6]*t[1]*t[5]-t[6]*t[2]*t[4]},determinant_3x3:function(e,t,n,r,i,a,o,s,c){return e*i*c-e*a*s-r*t*c+r*n*s+o*t*a-o*n*i}}})()})(n),(function(e){e.linalg=(function(){var e=function(e,t,n,r){r=e[t],e[t]=e[n],e[n]=r},t=function(e,t){return e=Math.abs(e),t=Math.abs(t),e>t?(t/=e,e*Math.sqrt(1+t*t)):t>0?(e/=t,t*Math.sqrt(1+e*e)):0},r=function(r,i,a,o,s,c){var l=n.EPSILON,u=0,d=0,f=0,p=0,m=0,h=0,g=0,_=0,v=0,y=c*c*30,b=0,x=0,S=0,C=0,w=0,T=0,E=0,D=0,O=0,k=n.cache.get_buffer(c<<2),A=n.cache.get_buffer(c<<2),j=k.i32,M=A.i32;if(o)for(;u<c;u++){for(f=u*s,d=0;d<c;d++)o[f+d]=0;o[f+u]=1}for(f=0;f<c;f++){if(a[f]=r[(i+1)*f],f<c-1){for(p=f+1,b=Math.abs(r[i*f+p]),u=f+2;u<c;u++)x=Math.abs(r[i*f+u]),b<x&&(b=x,p=u);j[f]=p}if(f>0){for(p=0,b=Math.abs(r[f]),u=1;u<f;u++)x=Math.abs(r[i*u+f]),b<x&&(b=x,p=u);M[f]=p}}if(c>1)for(;v<y;v++){for(f=0,b=Math.abs(r[j[0]]),u=1;u<c-1;u++)x=Math.abs(r[i*u+j[u]]),b<x&&(b=x,f=u);for(m=j[f],u=1;u<c;u++)x=Math.abs(r[i*M[u]+u]),b<x&&(b=x,f=M[u],m=u);if(S=r[i*f+m],Math.abs(S)<=l)break;for(C=(a[m]-a[f])*.5,w=Math.abs(C)+t(S,C),T=t(S,w),E=w/T,T=S/T,w=S/w*S,C<0&&(T=-T,w=-w),r[i*f+m]=0,a[f]-=w,a[m]+=w,u=0;u<f;u++)g=i*u+f,_=i*u+m,D=r[g],O=r[_],r[g]=D*E-O*T,r[_]=D*T+O*E;for(u=f+1;u<m;u++)g=i*f+u,_=i*u+m,D=r[g],O=r[_],r[g]=D*E-O*T,r[_]=D*T+O*E;for(u=m+1,g=i*f+u,_=i*m+u;u<c;u++,g++,_++)D=r[g],O=r[_],r[g]=D*E-O*T,r[_]=D*T+O*E;if(o)for(g=s*f,_=s*m,u=0;u<c;u++,g++,_++)D=o[g],O=o[_],o[g]=D*E-O*T,o[_]=D*T+O*E;for(d=0;d<2;d++){if(h=d==0?f:m,h<c-1){for(p=h+1,b=Math.abs(r[i*h+p]),u=h+2;u<c;u++)x=Math.abs(r[i*h+u]),b<x&&(b=x,p=u);j[h]=p}if(h>0){for(p=0,b=Math.abs(r[h]),u=1;u<h;u++)x=Math.abs(r[i*u+h]),b<x&&(b=x,p=u);M[h]=p}}}for(f=0;f<c-1;f++){for(p=f,u=f+1;u<c;u++)a[p]<a[u]&&(p=u);if(f!=p&&(e(a,p,f,b),o))for(u=0;u<c;u++)e(o,s*p+u,s*f+u,b)}n.cache.put_buffer(k),n.cache.put_buffer(A)},i=function(r,i,a,o,s,c,l,u){for(var d=n.EPSILON*2,f=n.FLT_MIN,p=0,m=0,h=0,g=0,_=Math.max(c,30),v=0,y=0,b=0,x=0,S=0,C=0,w=0,T=0,E=0,D=0,O=0,k=0,A=0,j=0,M=0,N=0,P=0,F=4660,I=0,L=0,R=0,z=n.cache.get_buffer(l<<3),B=z.f64;p<l;p++){for(h=0,O=0;h<c;h++)T=r[p*i+h],O+=T*T;if(B[p]=O,o){for(h=0;h<l;h++)o[p*s+h]=0;o[p*s+p]=1}}for(;g<_;g++){for(S=0,p=0;p<l-1;p++)for(m=p+1;m<l;m++){for(v=p*i|0,y=m*i|0,M=B[p],N=0,P=B[m],h=2,N+=r[v]*r[y],N+=r[v+1]*r[y+1];h<c;h++)N+=r[v+h]*r[y+h];if(!(Math.abs(N)<=d*Math.sqrt(M*P))){for(N*=2,k=M-P,A=t(N,k),k<0?(j=(A-k)*.5,w=Math.sqrt(j/A),C=N/(A*w*2)):(C=Math.sqrt((A+k)/(A*2)),w=N/(A*C*2)),M=0,P=0,h=2,E=C*r[v]+w*r[y],D=-w*r[v]+C*r[y],r[v]=E,r[y]=D,M+=E*E,P+=D*D,E=C*r[v+1]+w*r[y+1],D=-w*r[v+1]+C*r[y+1],r[v+1]=E,r[y+1]=D,M+=E*E,P+=D*D;h<c;h++)E=C*r[v+h]+w*r[y+h],D=-w*r[v+h]+C*r[y+h],r[v+h]=E,r[y+h]=D,M+=E*E,P+=D*D;if(B[p]=M,B[m]=P,S=1,o)for(b=p*s|0,x=m*s|0,h=2,E=C*o[b]+w*o[x],D=-w*o[b]+C*o[x],o[b]=E,o[x]=D,E=C*o[b+1]+w*o[x+1],D=-w*o[b+1]+C*o[x+1],o[b+1]=E,o[x+1]=D;h<l;h++)E=C*o[b+h]+w*o[x+h],D=-w*o[b+h]+C*o[x+h],o[b+h]=E,o[x+h]=D}}if(S==0)break}for(p=0;p<l;p++){for(h=0,O=0;h<c;h++)T=r[p*i+h],O+=T*T;B[p]=Math.sqrt(O)}for(p=0;p<l-1;p++){for(m=p,h=p+1;h<l;h++)B[m]<B[h]&&(m=h);if(p!=m&&(e(B,p,m,O),o)){for(h=0;h<c;h++)e(r,p*i+h,m*i+h,T);for(h=0;h<l;h++)e(o,p*s+h,m*s+h,T)}}for(p=0;p<l;p++)a[p]=B[p];if(!o){n.cache.put_buffer(z);return}for(p=0;p<u;p++){for(O=p<l?B[p]:0;O<=f;){for(L=1/c,h=0;h<c;h++)F=F*214013+2531011,I=F>>16&256?L:-L,r[p*i+h]=I;for(g=0;g<2;g++)for(m=0;m<p;m++){for(O=0,h=0;h<c;h++)O+=r[p*i+h]*r[m*i+h];for(R=0,h=0;h<c;h++)T=r[p*i+h]-O*r[m*i+h],r[p*i+h]=T,R+=Math.abs(T);for(R=R?1/R:0,h=0;h<c;h++)r[p*i+h]*=R}for(O=0,h=0;h<c;h++)T=r[p*i+h],O+=T*T;O=Math.sqrt(O)}for(w=1/O,h=0;h<c;h++)r[p*i+h]*=w}n.cache.put_buffer(z)};return{lu_solve:function(t,r){var i=0,a=0,o=0,s=1,c=t.cols,l=t.data,u=r.data,d,f,p,m;for(i=0;i<c;i++){for(o=i,a=i+1;a<c;a++)Math.abs(l[a*c+i])>Math.abs(l[o*c+i])&&(o=a);if(Math.abs(l[o*c+i])<n.EPSILON)return 0;if(o!=i){for(a=i;a<c;a++)e(l,i*c+a,o*c+a,d);e(u,i,o,d),s=-s}for(p=-1/l[i*c+i],a=i+1;a<c;a++){for(f=l[a*c+i]*p,o=i+1;o<c;o++)l[a*c+o]+=f*l[i*c+o];u[a]+=f*u[i]}l[i*c+i]=-p}for(i=c-1;i>=0;i--){for(m=u[i],o=i+1;o<c;o++)m-=l[i*c+o]*u[o];u[i]=m*l[i*c+i]}return 1},cholesky_solve:function(e,t){var n=0,r=0,i=0,a=0,o=0,s=0,c=0,l=e.cols,u=e.data,d=t.data,f,p;for(n=0;n<l;n++)for(p=1,a=n*l,o=a,r=n;r<l;r++){for(f=u[o+n],i=0;i<n;i++)f-=u[i*l+n]*u[o+i];if(r==n){if(u[o+n]=f,f==0)return 0;p=1/f}else u[a+r]=f,u[o+n]=f*p;o+=l}for(a=0,s=0;s<l;s++){for(f=d[s],c=0;c<s;c++)f-=u[a+c]*d[c];d[s]=f,a+=l}for(a=0,s=0;s<l;s++)d[s]/=u[a+s],a+=l;for(s=l-1;s>=0;s--){for(f=d[s],c=s+1,a=c*l;c<l;c++)f-=u[a+s]*d[c],a+=l;d[s]=f}return 1},svd_decompose:function(e,t,r,a,o){o===void 0&&(o=0);var s=0,c=0,l=e.rows,u=e.cols,d=l,f=u,p=e.type|n.C1_t;d<f&&(s=1,c=d,d=f,f=c);var m=n.cache.get_buffer(d*d<<3),h=n.cache.get_buffer(f<<3),g=n.cache.get_buffer(f*f<<3),_=new n.matrix_t(d,d,p,m.data),v=new n.matrix_t(1,f,p,h.data),y=new n.matrix_t(f,f,p,g.data);if(s==0)n.matmath.transpose(_,e);else{for(c=0;c<u*l;c++)_.data[c]=e.data[c];for(;c<f*d;c++)_.data[c]=0}if(i(_.data,d,v.data,y.data,f,d,f,d),t){for(c=0;c<f;c++)t.data[c]=v.data[c];for(;c<u;c++)t.data[c]=0}if(s==0){if(r&&o&n.SVD_U_T)for(c=d*d;--c>=0;)r.data[c]=_.data[c];else r&&n.matmath.transpose(r,_);if(a&&o&n.SVD_V_T)for(c=f*f;--c>=0;)a.data[c]=y.data[c];else a&&n.matmath.transpose(a,y)}else{if(r&&o&n.SVD_U_T)for(c=f*f;--c>=0;)r.data[c]=y.data[c];else r&&n.matmath.transpose(r,y);if(a&&o&n.SVD_V_T)for(c=d*d;--c>=0;)a.data[c]=_.data[c];else a&&n.matmath.transpose(a,_)}n.cache.put_buffer(m),n.cache.put_buffer(h),n.cache.put_buffer(g)},svd_solve:function(e,t,r){var i=0,a=0,o=0,s=0,c=0,l=e.rows,u=e.cols,d=0,f=0,p=0,m=e.type|n.C1_t,h=n.cache.get_buffer(l*l<<3),g=n.cache.get_buffer(u<<3),_=n.cache.get_buffer(u*u<<3),v=new n.matrix_t(l,l,m,h.data),y=new n.matrix_t(1,u,m,g.data),b=new n.matrix_t(u,u,m,_.data),x=r.data,S=v.data,C=y.data,w=b.data;for(this.svd_decompose(e,y,v,b,0),p=n.EPSILON*C[0]*u;i<u;i++,c+=u){for(f=0,a=0;a<u;a++)if(C[a]>p){for(o=0,d=0,s=0;o<l;o++,s+=u)d+=S[s+a]*x[o];f+=d*w[c+a]/C[a]}t.data[i]=f}n.cache.put_buffer(h),n.cache.put_buffer(g),n.cache.put_buffer(_)},svd_invert:function(e,t){var r=0,i=0,a=0,o=0,s=0,c=0,l=t.rows,u=t.cols,d=0,f=0,p=t.type|n.C1_t,m=n.cache.get_buffer(l*l<<3),h=n.cache.get_buffer(u<<3),g=n.cache.get_buffer(u*u<<3),_=new n.matrix_t(l,l,p,m.data),v=new n.matrix_t(1,u,p,h.data),y=new n.matrix_t(u,u,p,g.data),b=e.data,x=_.data,S=v.data,C=y.data;for(this.svd_decompose(t,v,_,y,0),f=n.EPSILON*S[0]*u;r<u;r++,s+=u)for(i=0,o=0;i<l;i++,c++){for(a=0,d=0;a<u;a++,o++)S[a]>f&&(d+=C[s+a]*x[o]/S[a]);b[c]=d}n.cache.put_buffer(m),n.cache.put_buffer(h),n.cache.put_buffer(g)},eigenVV:function(e,t,i){for(var a=e.cols,o=a*a,s=e.type|n.C1_t,c=n.cache.get_buffer(a*a<<3),l=n.cache.get_buffer(a<<3),u=new n.matrix_t(a,a,s,c.data),d=new n.matrix_t(1,a,s,l.data);--o>=0;)u.data[o]=e.data[o];if(r(u.data,a,d.data,t?t.data:null,a,a),i)for(;--a>=0;)i.data[a]=d.data[a];n.cache.put_buffer(c),n.cache.put_buffer(l)}}})()})(n),(function(e){var t=(function(){var e=function(e){return e*e},t=function(e,t,n,r,i){for(var a=0,o=0,s=0,c=0,l=0,u=0,d=0,f=0,p=0,m=0,h=0;a<i;++a)o+=e[a].x,s+=e[a].y,u+=t[a].x,d+=t[a].y;for(o/=i,s/=i,u/=i,d/=i,a=0;a<i;++a)m=e[a].x-o,h=e[a].y-s,c+=Math.sqrt(m*m+h*h),m=t[a].x-u,h=t[a].y-d,f+=Math.sqrt(m*m+h*h);c/=i,f/=i,l=Math.SQRT2/c,p=Math.SQRT2/f,n[0]=n[4]=l,n[2]=-o*l,n[5]=-s*l,n[1]=n[3]=n[6]=n[7]=0,n[8]=1,r[0]=r[4]=p,r[2]=-u*p,r[5]=-d*p,r[1]=r[3]=r[6]=r[7]=0,r[8]=1},r=new n.matrix_t(3,3,n.F32_t|n.C1_t),i=new n.matrix_t(3,3,n.F32_t|n.C1_t),a=new n.matrix_t(6,6,n.F32_t|n.C1_t),o=new n.matrix_t(6,1,n.F32_t|n.C1_t),s=(function(){function s(){}return s.prototype.run=function(e,s,c,l){var u=0,d=0,f=c.type|n.C1_t,p=c.data,m=r.data,h=i.data,g,_,v=0,y=0;t(e,s,m,h,l);for(var b=n.cache.get_buffer(2*l*6<<3),x=n.cache.get_buffer(2*l<<3),S=new n.matrix_t(6,2*l,f,b.data),C=new n.matrix_t(1,2*l,f,x.data),w=S.data,T=C.data;u<l;++u)g=e[u],_=s[u],v=m[0]*g.x+m[1]*g.y+m[2],y=m[3]*g.x+m[4]*g.y+m[5],d=u*2*6,w[d]=v,w[d+1]=y,w[d+2]=1,w[d+3]=0,w[d+4]=0,w[d+5]=0,d+=6,w[d]=0,w[d+1]=0,w[d+2]=0,w[d+3]=v,w[d+4]=y,w[d+5]=1,T[u<<1]=h[0]*_.x+h[1]*_.y+h[2],T[(u<<1)+1]=h[3]*_.x+h[4]*_.y+h[5];return n.matmath.multiply_AtA(a,S),n.matmath.multiply_AtB(o,S,C),n.linalg.lu_solve(a,o),p[0]=o.data[0],p[1]=o.data[1],p[2]=o.data[2],p[3]=o.data[3],p[4]=o.data[4],p[5]=o.data[5],p[6]=0,p[7]=0,p[8]=1,n.matmath.invert_3x3(i,i),n.matmath.multiply_3x3(c,i,c),n.matmath.multiply_3x3(c,c,r),n.cache.put_buffer(b),n.cache.put_buffer(x),1},s.prototype.error=function(t,n,r,i,a){for(var o=0,s,c,l=r.data;o<a;++o)s=t[o],c=n[o],i[o]=e(c.x-l[0]*s.x-l[1]*s.y-l[2])+e(c.y-l[3]*s.x-l[4]*s.y-l[5])},s.prototype.check_subset=function(e,t,n){return!0},s})(),c=new n.matrix_t(9,9,n.F32_t|n.C1_t),l=new n.matrix_t(9,9,n.F32_t|n.C1_t);return{affine2d:s,homography2d:(function(){function e(){}return e.prototype.run=function(e,t,a,o){for(var s=0,u=0,d=a.data,f=r.data,p=i.data,m=c.data,h=l.data,g=0,_=0,v=0,y=0,b=0,x=0,S=0,C=0,w=0,T=0,E=0,D=0;s<o;++s)S+=t[s].x,C+=t[s].y,E+=e[s].x,D+=e[s].y;for(S/=o,C/=o,E/=o,D/=o,s=0;s<o;++s)b+=Math.abs(t[s].x-S),x+=Math.abs(t[s].y-C),w+=Math.abs(e[s].x-E),T+=Math.abs(e[s].y-D);if(Math.abs(b)<n.EPSILON||Math.abs(x)<n.EPSILON||Math.abs(w)<n.EPSILON||Math.abs(T)<n.EPSILON)return 0;for(b=o/b,x=o/x,w=o/w,T=o/T,f[0]=w,f[1]=0,f[2]=-E*w,f[3]=0,f[4]=T,f[5]=-D*T,f[6]=0,f[7]=0,f[8]=1,p[0]=1/b,p[1]=0,p[2]=S,p[3]=0,p[4]=1/x,p[5]=C,p[6]=0,p[7]=0,p[8]=1,s=81;--s>=0;)m[s]=0;for(s=0;s<o;++s)g=(t[s].x-S)*b,_=(t[s].y-C)*x,v=(e[s].x-E)*w,y=(e[s].y-D)*T,m[0]+=v*v,m[1]+=v*y,m[2]+=v,m[6]+=v*-g*v,m[7]+=v*-g*y,m[8]+=v*-g,m[10]+=y*y,m[11]+=y,m[15]+=y*-g*v,m[16]+=y*-g*y,m[17]+=y*-g,m[20]+=1,m[24]+=-g*v,m[25]+=-g*y,m[26]+=-g,m[30]+=v*v,m[31]+=v*y,m[32]+=v,m[33]+=v*-_*v,m[34]+=v*-_*y,m[35]+=v*-_,m[40]+=y*y,m[41]+=y,m[42]+=y*-_*v,m[43]+=y*-_*y,m[44]+=y*-_,m[50]+=1,m[51]+=-_*v,m[52]+=-_*y,m[53]+=-_,m[60]+=-g*v*-g*v+-_*v*-_*v,m[61]+=-g*v*-g*y+-_*v*-_*y,m[62]+=-g*v*-g+-_*v*-_,m[70]+=-g*y*-g*y+-_*y*-_*y,m[71]+=-g*y*-g+-_*y*-_,m[80]+=-g*-g+-_*-_;for(s=0;s<9;++s)for(u=0;u<s;++u)m[s*9+u]=m[u*9+s];return n.linalg.eigenVV(c,l),d[0]=h[72],d[1]=h[73],d[2]=h[74],d[3]=h[75],d[4]=h[76],d[5]=h[77],d[6]=h[78],d[7]=h[79],d[8]=h[80],n.matmath.multiply_3x3(a,i,a),n.matmath.multiply_3x3(a,a,r),g=1/d[8],d[0]*=g,d[1]*=g,d[2]*=g,d[3]*=g,d[4]*=g,d[5]*=g,d[6]*=g,d[7]*=g,d[8]=1,1},e.prototype.error=function(e,t,n,r,i){for(var a=0,o,s,c=0,l=0,u=0,d=n.data;a<i;++a)o=e[a],s=t[a],c=1/(d[6]*o.x+d[7]*o.y+1),l=(d[0]*o.x+d[1]*o.y+d[2])*c-s.x,u=(d[3]*o.x+d[4]*o.y+d[5])*c-s.y,r[a]=l*l+u*u},e.prototype.check_subset=function(e,t,r){if(r==4){var i=0,a=e[0],o=e[1],s=e[2],c=e[3],l=t[0],u=t[1],d=t[2],f=t[3],p=a.x,m=a.y,h=1,g=o.x,_=o.y,v=1,y=s.x,b=s.y,x=1,S=l.x,C=l.y,w=1,T=u.x,E=u.y,D=1,O=d.x,k=d.y,A=1,j=n.matmath.determinant_3x3(p,m,h,g,_,v,y,b,x),M=n.matmath.determinant_3x3(S,C,w,T,E,D,O,k,A);if(j*M<0&&i++,p=o.x,m=o.y,g=s.x,_=s.y,y=c.x,b=c.y,S=u.x,C=u.y,T=d.x,E=d.y,O=f.x,k=f.y,j=n.matmath.determinant_3x3(p,m,h,g,_,v,y,b,x),M=n.matmath.determinant_3x3(S,C,w,T,E,D,O,k,A),j*M<0&&i++,p=a.x,m=a.y,g=s.x,_=s.y,y=c.x,b=c.y,S=l.x,C=l.y,T=d.x,E=d.y,O=f.x,k=f.y,j=n.matmath.determinant_3x3(p,m,h,g,_,v,y,b,x),M=n.matmath.determinant_3x3(S,C,w,T,E,D,O,k,A),j*M<0&&i++,p=a.x,m=a.y,g=o.x,_=o.y,y=c.x,b=c.y,S=l.x,C=l.y,T=u.x,E=u.y,O=f.x,k=f.y,j=n.matmath.determinant_3x3(p,m,h,g,_,v,y,b,x),M=n.matmath.determinant_3x3(S,C,w,T,E,D,O,k,A),j*M<0&&i++,i!=0&&i!=4)return!1}return!0},e})()}})(),r=(function(){function e(e,t,n,r){e===void 0&&(e=0),t===void 0&&(t=.5),n===void 0&&(n=.5),r===void 0&&(r=.99),this.size=e,this.thresh=t,this.eps=n,this.prob=r}return e.prototype.update_iters=function(e,t){var n=Math.log(1-this.prob),r=Math.log(1-(1-e)**this.size);return(r>=0||-n>=t*-r?t:Math.round(n/r))|0},e})(),i=(function(){var e=function(e,t,n,r,i,a,o){for(var s=1e3,c=[],l=0,u=0,d=0,f=0,p=!1;d<s;++d){for(l=0;l<r&&d<s;){for(p=!1,f=0;!p;)for(p=!0,f=c[l]=Math.floor(Math.random()*i)|0,u=0;u<l;++u)if(f==c[u]){p=!1;break}if(a[l]=t[f],o[l]=n[f],!e.check_subset(a,o,l+1)){d++;continue}++l}break}return l==r&&d<s},t=function(e,t,n,r,i,a,o,s){var c=0,l=0,u=0,d=a*a;for(e.error(n,r,t,o,i);l<i;++l)u=o[l]<=d,s[l]=u,c+=u;return c};return{ransac:function(r,i,a,o,s,c,l,u){if(u===void 0&&(u=1e3),s<r.size)return!1;var d=r.size,f=u,p=0,m=!1,h=[],g=[],_=!1,v=c.cols,y=c.rows,b=c.type|n.C1_t,x=n.cache.get_buffer(v*y<<3),S=n.cache.get_buffer(s),C=n.cache.get_buffer(s<<2),w=new n.matrix_t(v,y,b,x.data),T=new n.matrix_t(s,1,n.U8C1_t,S.data),E=-1,D=0,O=0,k=C.f32;if(s==d){if(i.run(a,o,w,s)<=0)return n.cache.put_buffer(x),n.cache.put_buffer(S),n.cache.put_buffer(C),!1;if(w.copy_to(c),l)for(;--s>=0;)l.data[s]=1;return n.cache.put_buffer(x),n.cache.put_buffer(S),n.cache.put_buffer(C),!0}for(;p<f;++p){if(_=e(i,a,o,d,s,h,g),!_){if(p==0)return n.cache.put_buffer(x),n.cache.put_buffer(S),n.cache.put_buffer(C),!1;break}O=i.run(h,g,w,d),!(O<=0)&&(D=t(i,w,a,o,s,r.thresh,k,T.data),D>Math.max(E,d-1)&&(w.copy_to(c),E=D,l&&T.copy_to(l),f=r.update_iters((s-D)/s,f),m=!0))}return n.cache.put_buffer(x),n.cache.put_buffer(S),n.cache.put_buffer(C),m},lmeds:function(r,i,a,o,s,c,l,u){if(u===void 0&&(u=1e3),s<r.size)return!1;var d=r.size,f=u,p=0,m=!1,h=[],g=[],_=!1,v=c.cols,y=c.rows,b=c.type|n.C1_t,x=n.cache.get_buffer(v*y<<3),S=n.cache.get_buffer(s),C=n.cache.get_buffer(s<<2),w=new n.matrix_t(v,y,b,x.data),T=new n.matrix_t(s,1,n.U8_t|n.C1_t,S.data),E=0,D=0,O=C.f32,k=1e9,A=0,j=0;if(r.eps=.45,f=r.update_iters(r.eps,f),s==d){if(i.run(a,o,w,s)<=0)return n.cache.put_buffer(x),n.cache.put_buffer(S),n.cache.put_buffer(C),!1;if(w.copy_to(c),l)for(;--s>=0;)l.data[s]=1;return n.cache.put_buffer(x),n.cache.put_buffer(S),n.cache.put_buffer(C),!0}for(;p<f;++p){if(_=e(i,a,o,d,s,h,g),!_){if(p==0)return n.cache.put_buffer(x),n.cache.put_buffer(S),n.cache.put_buffer(C),!1;break}D=i.run(h,g,w,d),!(D<=0)&&(i.error(a,o,w,O,s),j=n.math.median(O,0,s-1),j<k&&(k=j,w.copy_to(c),m=!0))}return m&&=(A=2.5*1.4826*(1+5/(s-d))*Math.sqrt(k),A=Math.max(A,.001),E=t(i,c,a,o,s,A,O,T.data),l&&T.copy_to(l),E>=d),n.cache.put_buffer(x),n.cache.put_buffer(S),n.cache.put_buffer(C),m}}})();e.ransac_params_t=r,e.motion_model=t,e.motion_estimator=i})(n),(function(e){e.imgproc=(function(){var e=function(e,t,r,i){for(var a=0,o=e.channel,s=e.cols,c=e.rows,l=e.data,u=t.data,d=s/r,f=c/i,p=d*f*65536|0,m=0,h=0,g=0,_=0,v=0,y=0,b=0,x=0,S=0,C=0,w=0,T=0,E=0,D=0,O=0,k=0,A=n.cache.get_buffer(r*o<<2),j=n.cache.get_buffer(r*o<<2),M=n.cache.get_buffer(s*2*3<<2),N=A.i32,P=j.i32,F=M.i32;m<r;m++){for(S=m*d,C=S+d,v=S+1-1e-6|0,y=C|0,v=Math.min(v,s-1),y=Math.min(y,s-1),v>S&&(F[x++]=m*o|0,F[x++]=(v-1)*o|0,F[x++]=(v-S)*256|0,a++),g=v;g<y;g++)a++,F[x++]=m*o|0,F[x++]=g*o|0,F[x++]=256;C-y>.001&&(a++,F[x++]=m*o|0,F[x++]=y*o|0,F[x++]=(C-y)*256|0)}for(m=0;m<r*o;m++)N[m]=P[m]=0;for(h=0,_=0;_<c;_++){for(w=s*_,x=0;x<a;x++)for(E=F[x*3],v=F[x*3+1],D=F[x*3+2],b=0;b<o;b++)N[E+b]+=l[w+v+b]*D;if((h+1)*f<=_+1||_==c-1){if(O=Math.max(_+1-(h+1)*f,0)*256|0,k=256-O,T=r*h,O<=0)for(m=0;m<r*o;m++)u[T+m]=Math.min(Math.max((P[m]+N[m]*256)/p,0),255),P[m]=N[m]=0;else for(m=0;m<r*o;m++)u[T+m]=Math.min(Math.max((P[m]+N[m]*k)/p,0),255),P[m]=N[m]*O,N[m]=0;h++}else for(m=0;m<r*o;m++)P[m]+=N[m]*256,N[m]=0}n.cache.put_buffer(j),n.cache.put_buffer(A),n.cache.put_buffer(M)},t=function(e,t,r,i){for(var a=0,o=e.channel,s=e.cols,c=e.rows,l=e.data,u=t.data,d=s/r,f=c/i,p=1/(d*f),m=0,h=0,g=0,_=0,v=0,y=0,b=0,x=0,S=0,C=0,w=0,T=0,E=0,D=0,O=0,k=0,A=n.cache.get_buffer(r*o<<2),j=n.cache.get_buffer(r*o<<2),M=n.cache.get_buffer(s*2*3<<2),N=A.f32,P=j.f32,F=M.f32;m<r;m++){for(S=m*d,C=S+d,v=S+1-1e-6|0,y=C|0,v=Math.min(v,s-1),y=Math.min(y,s-1),v>S&&(a++,F[x++]=(v-1)*o|0,F[x++]=m*o|0,F[x++]=(v-S)*p),g=v;g<y;g++)a++,F[x++]=g*o|0,F[x++]=m*o|0,F[x++]=p;C-y>.001&&(a++,F[x++]=y*o|0,F[x++]=m*o|0,F[x++]=(C-y)*p)}for(m=0;m<r*o;m++)N[m]=P[m]=0;for(h=0,_=0;_<c;_++){for(w=s*_,x=0;x<a;x++)for(v=F[x*3]|0,E=F[x*3+1]|0,D=F[x*3+2],b=0;b<o;b++)N[E+b]+=l[w+v+b]*D;if((h+1)*f<=_+1||_==c-1){if(O=Math.max(_+1-(h+1)*f,0),k=1-O,T=r*h,Math.abs(O)<.001)for(m=0;m<r*o;m++)u[T+m]=P[m]+N[m],P[m]=N[m]=0;else for(m=0;m<r*o;m++)u[T+m]=P[m]+N[m]*k,P[m]=N[m]*O,N[m]=0;h++}else for(m=0;m<r*o;m++)P[m]+=N[m],N[m]=0}n.cache.put_buffer(j),n.cache.put_buffer(A),n.cache.put_buffer(M)},r=function(e,t,n,r,i,a,o,s){for(var c=0,l=0,u=0,d=0,f=0,p=0,m=0,h=0,g=0,_=a[0],v=0,y=r<<1,b=r*3,x=r<<2;c<i;++c){for(p=t[d],l=0;l<s;++l)e[l]=p;for(l=0;l<=r-2;l+=2)e[l+s]=t[d+l],e[l+s+1]=t[d+l+1];for(;l<r;++l)e[l+s]=t[d+l];for(p=t[d+r-1],l=r;l<s+r;++l)e[l+s]=p;for(l=0;l<=r-4;l+=4){for(p=e[l]*_,m=e[l+1]*_,h=e[l+2]*_,g=e[l+3]*_,u=1;u<o;++u)v=a[u],p+=e[u+l]*v,m+=e[u+l+1]*v,h+=e[u+l+2]*v,g+=e[u+l+3]*v;n[f+l]=Math.min(p>>8,255),n[f+l+1]=Math.min(m>>8,255),n[f+l+2]=Math.min(h>>8,255),n[f+l+3]=Math.min(g>>8,255)}for(;l<r;++l){for(p=e[l]*_,u=1;u<o;++u)p+=e[u+l]*a[u];n[f+l]=Math.min(p>>8,255)}d+=r,f+=r}for(c=0;c<r;++c){for(p=n[c],l=0;l<s;++l)e[l]=p;for(u=c,l=0;l<=i-2;l+=2,u+=y)e[l+s]=n[u],e[l+s+1]=n[u+r];for(;l<i;++l,u+=r)e[l+s]=n[u];for(p=n[(i-1)*r+c],l=i;l<s+i;++l)e[l+s]=p;for(f=c,l=0;l<=i-4;l+=4,f+=x){for(p=e[l]*_,m=e[l+1]*_,h=e[l+2]*_,g=e[l+3]*_,u=1;u<o;++u)v=a[u],p+=e[u+l]*v,m+=e[u+l+1]*v,h+=e[u+l+2]*v,g+=e[u+l+3]*v;n[f]=Math.min(p>>8,255),n[f+r]=Math.min(m>>8,255),n[f+y]=Math.min(h>>8,255),n[f+b]=Math.min(g>>8,255)}for(;l<i;++l,f+=r){for(p=e[l]*_,u=1;u<o;++u)p+=e[u+l]*a[u];n[f]=Math.min(p>>8,255)}}},i=function(e,t,n,r,i,a,o,s){for(var c=0,l=0,u=0,d=0,f=0,p=0,m=0,h=0,g=0,_=a[0],v=0,y=r<<1,b=r*3,x=r<<2;c<i;++c){for(p=t[d],l=0;l<s;++l)e[l]=p;for(l=0;l<=r-2;l+=2)e[l+s]=t[d+l],e[l+s+1]=t[d+l+1];for(;l<r;++l)e[l+s]=t[d+l];for(p=t[d+r-1],l=r;l<s+r;++l)e[l+s]=p;for(l=0;l<=r-4;l+=4){for(p=e[l]*_,m=e[l+1]*_,h=e[l+2]*_,g=e[l+3]*_,u=1;u<o;++u)v=a[u],p+=e[u+l]*v,m+=e[u+l+1]*v,h+=e[u+l+2]*v,g+=e[u+l+3]*v;n[f+l]=p,n[f+l+1]=m,n[f+l+2]=h,n[f+l+3]=g}for(;l<r;++l){for(p=e[l]*_,u=1;u<o;++u)p+=e[u+l]*a[u];n[f+l]=p}d+=r,f+=r}for(c=0;c<r;++c){for(p=n[c],l=0;l<s;++l)e[l]=p;for(u=c,l=0;l<=i-2;l+=2,u+=y)e[l+s]=n[u],e[l+s+1]=n[u+r];for(;l<i;++l,u+=r)e[l+s]=n[u];for(p=n[(i-1)*r+c],l=i;l<s+i;++l)e[l+s]=p;for(f=c,l=0;l<=i-4;l+=4,f+=x){for(p=e[l]*_,m=e[l+1]*_,h=e[l+2]*_,g=e[l+3]*_,u=1;u<o;++u)v=a[u],p+=e[u+l]*v,m+=e[u+l+1]*v,h+=e[u+l+2]*v,g+=e[u+l+3]*v;n[f]=p,n[f+r]=m,n[f+y]=h,n[f+b]=g}for(;l<i;++l,f+=r){for(p=e[l]*_,u=1;u<o;++u)p+=e[u+l]*a[u];n[f]=p}}};return{grayscale:function(e,t,r,i,a){a===void 0&&(a=n.COLOR_RGBA2GRAY);var o=0,s=0,c=0,l=0,u=0,d=0,f=4899,p=9617,m=1868,h=4;(a==n.COLOR_BGRA2GRAY||a==n.COLOR_BGR2GRAY)&&(f=1868,m=4899),(a==n.COLOR_RGB2GRAY||a==n.COLOR_BGR2GRAY)&&(h=3);var g=h<<1,_=h*3|0;i.resize(t,r,1);var v=i.data;for(s=0;s<r;++s,l+=t,c+=t*h){for(o=0,u=c,d=l;o<=t-4;o+=4,u+=h<<2,d+=4)v[d]=e[u]*f+e[u+1]*p+e[u+2]*m+8192>>14,v[d+1]=e[u+h]*f+e[u+h+1]*p+e[u+h+2]*m+8192>>14,v[d+2]=e[u+g]*f+e[u+g+1]*p+e[u+g+2]*m+8192>>14,v[d+3]=e[u+_]*f+e[u+_+1]*p+e[u+_+2]*m+8192>>14;for(;o<t;++o,++d,u+=h)v[d]=e[u]*f+e[u+1]*p+e[u+2]*m+8192>>14}},resample:function(r,i,a,o){var s=r.rows,c=r.cols;s>o&&c>a&&(i.resize(a,o,r.channel),r.type&n.U8_t&&i.type&n.U8_t&&s*c/(o*a)<256?e(r,i,a,o):t(r,i,a,o))},box_blur_gray:function(e,t,r,i){i===void 0&&(i=0);var a=e.cols,o=e.rows,s=o<<1,c=a<<1,l=0,u=0,d=0,f=0,p=(r<<1)+1|0,m=r+1|0,h=m+1|0,g=i&n.BOX_BLUR_NOSCALE?1:1/(p*p),_=n.cache.get_buffer(a*o<<2),v=0,y=0,b=0,x=0,S=0,C=_.i32,w=e.data,T=0;for(t.resize(a,o,e.channel),d=0;d<o;++d){for(y=d,v=m*w[b],l=b+1|0,f=b+r|0;l<=f;++l)v+=w[l];for(x=b+m|0,S=b,T=w[S],u=0;u<r;++u,y+=o)C[y]=v,v+=w[x]-T,x++;for(;u<a-h;u+=2,y+=s)C[y]=v,v+=w[x]-w[S],C[y+o]=v,v+=w[x+1]-w[S+1],x+=2,S+=2;for(;u<a-m;++u,y+=o)C[y]=v,v+=w[x]-w[S],x++,S++;for(T=w[x-1];u<a;++u,y+=o)C[y]=v,v+=T-w[S],S++;b+=a}if(b=0,w=t.data,g==1)for(d=0;d<a;++d){for(y=d,v=m*C[b],l=b+1|0,f=b+r|0;l<=f;++l)v+=C[l];for(x=b+m,S=b,T=C[S],u=0;u<r;++u,y+=a)w[y]=v,v+=C[x]-T,x++;for(;u<o-h;u+=2,y+=c)w[y]=v,v+=C[x]-C[S],w[y+a]=v,v+=C[x+1]-C[S+1],x+=2,S+=2;for(;u<o-m;++u,y+=a)w[y]=v,v+=C[x]-C[S],x++,S++;for(T=C[x-1];u<o;++u,y+=a)w[y]=v,v+=T-C[S],S++;b+=o}else for(d=0;d<a;++d){for(y=d,v=m*C[b],l=b+1|0,f=b+r|0;l<=f;++l)v+=C[l];for(x=b+m,S=b,T=C[S],u=0;u<r;++u,y+=a)w[y]=v*g,v+=C[x]-T,x++;for(;u<o-h;u+=2,y+=c)w[y]=v*g,v+=C[x]-C[S],w[y+a]=v*g,v+=C[x+1]-C[S+1],x+=2,S+=2;for(;u<o-m;++u,y+=a)w[y]=v*g,v+=C[x]-C[S],x++,S++;for(T=C[x-1];u<o;++u,y+=a)w[y]=v*g,v+=T-C[S],S++;b+=o}n.cache.put_buffer(_)},gaussian_blur:function(e,t,a,o){o===void 0&&(o=0),a===void 0&&(a=0),a=a==0?Math.max(1,4*o+1-1e-8)*2+1|0:a;var s=a>>1,c=e.cols,l=e.rows,u=e.type,d=u&n.U8_t;t.resize(c,l,e.channel);var f=e.data,p=t.data,m,h,g=a+Math.max(l,c)|0,_=n.cache.get_buffer(g<<2),v=n.cache.get_buffer(a<<2);d?(m=_.i32,h=v.i32):u&n.S32_t?(m=_.i32,h=v.f32):(m=_.f32,h=v.f32),n.math.get_gaussian_kernel(a,o,h,u),d?r(m,f,p,c,l,h,a,s):i(m,f,p,c,l,h,a,s),n.cache.put_buffer(_),n.cache.put_buffer(v)},pyrdown:function(e,t,n,r){n===void 0&&(n=0),r===void 0&&(r=0);var i=e.cols,a=e.rows,o=i>>1,s=a>>1,c=o-(n<<1),l=s-(r<<1),u=0,d=0,f=n+r*i,p=0,m=0,h=0;t.resize(o,s,e.channel);var g=e.data,_=t.data;for(d=0;d<l;++d){for(p=f,h=m,u=0;u<=c-2;u+=2,h+=2,p+=4)_[h]=g[p]+g[p+1]+g[p+i]+g[p+i+1]+2>>2,_[h+1]=g[p+2]+g[p+3]+g[p+i+2]+g[p+i+3]+2>>2;for(;u<c;++u,++h,p+=2)_[h]=g[p]+g[p+1]+g[p+i]+g[p+i+1]+2>>2;f+=i<<1,m+=o}},scharr_derivatives:function(e,t){var r=e.cols,i=e.rows,a=r<<1,o=0,s=0,c=0,l,u,d,f,p,m,h=0,g=0,_=0,v=0,y,b;t.resize(r,i,2);var x=e.data,S=t.data,C=n.cache.get_buffer(r+2<<2),w=n.cache.get_buffer(r+2<<2);for(e.type&n.U8_t||e.type&n.S32_t?(y=C.i32,b=w.i32):(y=C.f32,b=w.f32);s<i;++s,g+=r){for(h=(s>0?s-1:1)*r|0,_=(s<i-1?s+1:i-2)*r|0,v=s*a|0,o=0,c=1;o<=r-2;o+=2,c+=2)l=x[h+o],u=x[_+o],y[c]=(l+u)*3+x[g+o]*10,b[c]=u-l,l=x[h+o+1],u=x[_+o+1],y[c+1]=(l+u)*3+x[g+o+1]*10,b[c+1]=u-l;for(;o<r;++o,++c)l=x[h+o],u=x[_+o],y[c]=(l+u)*3+x[g+o]*10,b[c]=u-l;for(o=r+1|0,y[0]=y[1],y[o]=y[r],b[0]=b[1],b[o]=b[r],o=0;o<=r-4;o+=4)l=b[o+2],u=b[o+1],d=b[o+3],f=b[o+4],p=y[o+2],m=y[o+3],S[v++]=p-y[o],S[v++]=(l+b[o])*3+u*10,S[v++]=m-y[o+1],S[v++]=(d+u)*3+l*10,S[v++]=y[o+4]-p,S[v++]=(f+l)*3+d*10,S[v++]=y[o+5]-m,S[v++]=(b[o+5]+d)*3+f*10;for(;o<r;++o)S[v++]=y[o+2]-y[o],S[v++]=(b[o+2]+b[o])*3+b[o+1]*10}n.cache.put_buffer(C),n.cache.put_buffer(w)},sobel_derivatives:function(e,t){var r=e.cols,i=e.rows,a=r<<1,o=0,s=0,c=0,l,u,d,f,p,m,h=0,g=0,_=0,v=0,y,b;t.resize(r,i,2);var x=e.data,S=t.data,C=n.cache.get_buffer(r+2<<2),w=n.cache.get_buffer(r+2<<2);for(e.type&n.U8_t||e.type&n.S32_t?(y=C.i32,b=w.i32):(y=C.f32,b=w.f32);s<i;++s,g+=r){for(h=(s>0?s-1:1)*r|0,_=(s<i-1?s+1:i-2)*r|0,v=s*a|0,o=0,c=1;o<=r-2;o+=2,c+=2)l=x[h+o],u=x[_+o],y[c]=l+u+x[g+o]*2,b[c]=u-l,l=x[h+o+1],u=x[_+o+1],y[c+1]=l+u+x[g+o+1]*2,b[c+1]=u-l;for(;o<r;++o,++c)l=x[h+o],u=x[_+o],y[c]=l+u+x[g+o]*2,b[c]=u-l;for(o=r+1|0,y[0]=y[1],y[o]=y[r],b[0]=b[1],b[o]=b[r],o=0;o<=r-4;o+=4)l=b[o+2],u=b[o+1],d=b[o+3],f=b[o+4],p=y[o+2],m=y[o+3],S[v++]=p-y[o],S[v++]=l+b[o]+u*2,S[v++]=m-y[o+1],S[v++]=d+u+l*2,S[v++]=y[o+4]-p,S[v++]=f+l+d*2,S[v++]=y[o+5]-m,S[v++]=b[o+5]+d+f*2;for(;o<r;++o)S[v++]=y[o+2]-y[o],S[v++]=b[o+2]+b[o]+b[o+1]*2}n.cache.put_buffer(C),n.cache.put_buffer(w)},compute_integral_image:function(e,t,n,r){var i=e.cols|0,a=e.rows|0,o=e.data,s=i+1|0,c=0,l=0,u=0,d=0,f=0,p=0,m=0,h=0;if(t&&n){for(;f<s;++f)t[f]=0,n[f]=0;for(u=s+1|0,d=1,f=0,h=0;f<a;++f,++u,++d){for(c=l=0,p=0;p<=i-2;p+=2,h+=2,u+=2,d+=2)m=o[h],c+=m,l+=m*m,t[u]=t[d]+c,n[u]=n[d]+l,m=o[h+1],c+=m,l+=m*m,t[u+1]=t[d+1]+c,n[u+1]=n[d+1]+l;for(;p<i;++p,++h,++u,++d)m=o[h],c+=m,l+=m*m,t[u]=t[d]+c,n[u]=n[d]+l}}else if(t){for(;f<s;++f)t[f]=0;for(u=s+1|0,d=1,f=0,h=0;f<a;++f,++u,++d){for(c=0,p=0;p<=i-2;p+=2,h+=2,u+=2,d+=2)c+=o[h],t[u]=t[d]+c,c+=o[h+1],t[u+1]=t[d+1]+c;for(;p<i;++p,++h,++u,++d)c+=o[h],t[u]=t[d]+c}}else if(n){for(;f<s;++f)n[f]=0;for(u=s+1|0,d=1,f=0,h=0;f<a;++f,++u,++d){for(l=0,p=0;p<=i-2;p+=2,h+=2,u+=2,d+=2)m=o[h],l+=m*m,n[u]=n[d]+l,m=o[h+1],l+=m*m,n[u+1]=n[d+1]+l;for(;p<i;++p,++h,++u,++d)m=o[h],l+=m*m,n[u]=n[d]+l}}if(r){for(f=0;f<s;++f)r[f]=0;for(u=s+1|0,d=0,f=0,h=0;f<a;++f,++u,++d){for(p=0;p<=i-2;p+=2,h+=2,u+=2,d+=2)r[u]=o[h]+r[d],r[u+1]=o[h+1]+r[d+1];for(;p<i;++p,++h,++u,++d)r[u]=o[h]+r[d]}for(u=s+i|0,d=i,f=0;f<a;++f,u+=s,d+=s)r[u]+=r[d];for(p=i-1;p>0;--p)for(u=p+a*s,d=u-s,f=a;f>0;--f,u-=s,d-=s)r[u]+=r[d]+r[d+1]}},equalize_histogram:function(e,t){var r=e.cols,i=e.rows,a=e.data;t.resize(r,i,e.channel);var o=t.data,s=r*i,c=0,l=0,u,d,f=n.cache.get_buffer(1024);for(u=f.i32;c<256;++c)u[c]=0;for(c=0;c<s;++c)++u[a[c]];for(l=u[0],c=1;c<256;++c)l=u[c]+=l;for(d=255/s,c=0;c<s;++c)o[c]=u[a[c]]*d+.5|0;n.cache.put_buffer(f)},canny:function(e,t,r,i){var a=e.cols,o=e.rows;e.data,t.resize(a,o,e.channel);var s=t.data,c=0,l=0,u=0,d=a<<1,f=0,p=0,m=0,h=0,g=0,_=0,v=0,y=0,b=n.cache.get_buffer(o*d<<2),x=n.cache.get_buffer(3*(a+2)<<2),S=n.cache.get_buffer((o+2)*(a+2)<<2),C=n.cache.get_buffer(o*a<<2),w=x.i32,T=S.i32,E=C.i32,D=b.i32,O=new n.matrix_t(a,o,n.S32C2_t,b.data),k=1,A=a+2+1|0,j=2*(a+2)+1|0,M=a+2|0,N=M+1|0,P=0;for(this.sobel_derivatives(e,O),r>i&&(c=r,r=i,i=c),c=3*(a+2)|0;--c>=0;)w[c]=0;for(c=(o+2)*(a+2)|0;--c>=0;)T[c]=0;for(;l<a;++l,u+=2)h=D[u],g=D[u+1],w[A+l]=(h^h>>31)-(h>>31)+((g^g>>31)-(g>>31));for(c=1;c<=o;++c,u+=d){if(c==o)for(l=j+a;--l>=j;)w[l]=0;else for(l=0;l<a;l++)h=D[u+(l<<1)],g=D[u+(l<<1)+1],w[j+l]=(h^h>>31)-(h>>31)+((g^g>>31)-(g>>31));for(f=u-d|0,T[N-1]=0,p=0,l=0;l<a;++l,f+=2){if(m=w[A+l],m>r){if(h=D[f],g=D[f+1],_=h^g,h=(h^h>>31)-(h>>31)|0,g=(g^g>>31)-(g>>31)|0,v=h*13573,y=v+(h+h<<15),g<<=15,g<v){if(m>w[A+l-1]&&m>=w[A+l+1]){m>i&&!p&&T[N+l-M]!=2?(T[N+l]=2,p=1,E[P++]=N+l):T[N+l]=1;continue}}else if(g>y){if(m>w[k+l]&&m>=w[j+l]){m>i&&!p&&T[N+l-M]!=2?(T[N+l]=2,p=1,E[P++]=N+l):T[N+l]=1;continue}}else if(_=_<0?-1:1,m>w[k+l-_]&&m>w[j+l+_]){m>i&&!p&&T[N+l-M]!=2?(T[N+l]=2,p=1,E[P++]=N+l):T[N+l]=1;continue}}T[N+l]=0,p=0}T[N+a]=0,N+=M,l=k,k=A,A=j,j=l}for(l=N-M-1,c=0;c<M;++c,++l)T[l]=0;for(;P>0;)N=E[--P],N-=M+1,T[N]==1&&(T[N]=2,E[P++]=N),N+=1,T[N]==1&&(T[N]=2,E[P++]=N),N+=1,T[N]==1&&(T[N]=2,E[P++]=N),N+=M,T[N]==1&&(T[N]=2,E[P++]=N),N-=2,T[N]==1&&(T[N]=2,E[P++]=N),N+=M,T[N]==1&&(T[N]=2,E[P++]=N),N+=1,T[N]==1&&(T[N]=2,E[P++]=N),N+=1,T[N]==1&&(T[N]=2,E[P++]=N);for(N=M+1,k=0,c=0;c<o;++c,N+=M)for(l=0;l<a;++l)s[k++]=(T[N+l]==2)*255;n.cache.put_buffer(b),n.cache.put_buffer(x),n.cache.put_buffer(S),n.cache.put_buffer(C)},warp_perspective:function(e,t,n,r){r===void 0&&(r=0);for(var i=e.cols|0,a=e.rows|0,o=t.cols|0,s=t.rows|0,c=e.data,l=t.data,u=0,d=0,f=0,p=0,m=0,h=0,g=0,_=0,v=0,y=0,b=0,x=0,S=0,C=0,w=0,T=n.data,E=T[0],D=T[1],O=T[2],k=T[3],A=T[4],j=T[5],M=T[6],N=T[7],P=T[8],F=0;d<s;++d)for(_=D*d+O,v=A*d+j,y=N*d+P,u=0;u<o;++u,++F,_+=E,v+=k,y+=M)b=1/y,h=_*b,g=v*b,p=h|0,m=g|0,h>0&&g>0&&p<i-1&&m<a-1?(x=Math.max(h-p,0),S=Math.max(g-m,0),f=i*m+p|0,C=c[f]+x*(c[f+1]-c[f]),w=c[f+i]+x*(c[f+i+1]-c[f+i]),l[F]=C+S*(w-C)):l[F]=r},warp_affine:function(e,t,n,r){r===void 0&&(r=0);for(var i=e.cols,a=e.rows,o=t.cols,s=t.rows,c=e.data,l=t.data,u=0,d=0,f=0,p=0,m=0,h=0,g=0,_=0,v=0,y=0,b=0,x=n.data,S=x[0],C=x[1],w=x[2],T=x[3],E=x[4],D=x[5],O=0;d<s;++d)for(h=C*d+w,g=E*d+D,u=0;u<o;++u,++O,h+=S,g+=T)p=h|0,m=g|0,p>=0&&m>=0&&p<i-1&&m<a-1?(_=h-p,v=g-m,f=i*m+p,y=c[f]+_*(c[f+1]-c[f]),b=c[f+i]+_*(c[f+i+1]-c[f+i]),l[O]=y+v*(b-y)):l[O]=r},skindetector:function(e,t){for(var n,r,i,a,o=e.width*e.height;o--;)a=o*4,n=e.data[a],r=e.data[a+1],i=e.data[a+2],n>95&&r>40&&i>20&&n>r&&n>i&&n-Math.min(r,i)>15&&Math.abs(n-r)>15?t[o]=255:t[o]=0}}})()})(n),(function(e){var t=(function(){var e=new Int32Array([0,3,1,3,2,2,3,1,3,0,3,-1,2,-2,1,-3,0,-3,-1,-3,-2,-2,-3,-1,-3,0,-3,1,-2,2,-1,3]),t=new Uint8Array(512),r=new Int32Array(25),i=new Int32Array(25),a=function(t,n,r){for(var i=0,a=e;i<r;++i)t[i]=a[i<<1]+a[(i<<1)+1]*n;for(;i<25;++i)t[i]=t[i-r]},o=function(e,t,n,r,i){for(var a=25,o=0,s=e[t],c=i,l=0,u=0,d=0;o<a;++o)r[o]=s-e[t+n[o]];for(o=0;o<16;o+=2)l=Math.min(r[o+1],r[o+2]),l=Math.min(l,r[o+3]),!(l<=c)&&(l=Math.min(l,r[o+4]),l=Math.min(l,r[o+5]),l=Math.min(l,r[o+6]),l=Math.min(l,r[o+7]),l=Math.min(l,r[o+8]),c=Math.max(c,Math.min(l,r[o])),c=Math.max(c,Math.min(l,r[o+9])));for(u=-c,o=0;o<16;o+=2)d=Math.max(r[o+1],r[o+2]),d=Math.max(d,r[o+3]),d=Math.max(d,r[o+4]),d=Math.max(d,r[o+5]),!(d>=u)&&(d=Math.max(d,r[o+6]),d=Math.max(d,r[o+7]),d=Math.max(d,r[o+8]),u=Math.min(u,Math.max(d,r[o])),u=Math.min(u,Math.max(d,r[o+9])));return-u-1},s=20;return{set_threshold:function(e){s=Math.min(Math.max(e,0),255);for(var n=-255;n<=255;++n)t[n+255]=n<-s?1:n>s?2:0;return s},detect:function(e,c,l){l===void 0&&(l=3);var u=8,d=25,f=e.data,p=e.cols,m=e.rows,h=0,g=0,_=0,v=0,y=0,b=0,x=n.cache.get_buffer(3*p),S=n.cache.get_buffer((p+1)*3<<2),C=x.u8,w=S.i32,T=r,E=i,D=Math.max(3,l),O=Math.min(m-2,m-l),k=Math.max(3,l),A=Math.min(p-3,p-l),j=0,M=0,N,P=o,F=t,I=s,L=0,R=0,z=0,B=0,V=0,H=0,U=0,W=0,G=0,K=0,ee=0,q=0;a(T,p,16);var te=T[0],ne=T[1],re=T[2],ie=T[3],J=T[4],ae=T[5],oe=T[6],se=T[7],ce=T[8],le=T[9],ue=T[10],Y=T[11],X=T[12],de=T[13],Z=T[14],Q=T[15];for(h=0;h<p*3;++h)C[h]=0;for(h=D;h<O;++h){for(U=h*p+k|0,b=(h-3)%3,H=b*p|0,V=b*(p+1)|0,g=0;g<p;++g)C[H+g]=0;if(B=0,h<O-1){for(g=k;g<A;++g,++U)if(L=f[U],R=-L+255,z=F[R+f[U+te]]|F[R+f[U+ce]],z!=0&&(z&=F[R+f[U+re]]|F[R+f[U+ue]],z&=F[R+f[U+J]]|F[R+f[U+X]],z&=F[R+f[U+oe]]|F[R+f[U+Z]],z!=0)){if(z&=F[R+f[U+ne]]|F[R+f[U+le]],z&=F[R+f[U+ie]]|F[R+f[U+Y]],z&=F[R+f[U+ae]]|F[R+f[U+de]],z&=F[R+f[U+se]]|F[R+f[U+Q]],z&1)for(v=L-I,j=0,_=0;_<d;++_)if(y=f[U+T[_]],y<v){if(++j,j>u){++B,w[V+B]=g,C[H+g]=P(f,U,T,E,I);break}}else j=0;if(z&2)for(v=L+I,j=0,_=0;_<d;++_)if(y=f[U+T[_]],y>v){if(++j,j>u){++B,w[V+B]=g,C[H+g]=P(f,U,T,E,I);break}}else j=0}}if(w[V+p]=B,h!=D)for(b=(h-4+3)%3,W=b*p|0,V=b*(p+1)|0,b=(h-5+3)%3,G=b*p|0,B=w[V+p],_=0;_<B;++_)g=w[V+_],K=g+1|0,ee=g-1|0,q=C[W+g],q>C[W+K]&&q>C[W+ee]&&q>C[G+ee]&&q>C[G+g]&&q>C[G+K]&&q>C[H+ee]&&q>C[H+g]&&q>C[H+K]&&(N=c[M],N.x=g,N.y=h-1,N.score=q,M++)}return n.cache.put_buffer(x),n.cache.put_buffer(S),M}}})();e.fast_corners=t,t.set_threshold(20)})(n),(function(e){e.yape06=(function(){var e=function(e,t,n,r,i,a,o,s,c,l){var u=0,d=0,f=s*n+o|0,p=f;for(u=s;u<l;++u,f+=n,p=f)for(d=o;d<c;++d,++p)t[p]=-4*e[p]+e[p+i]+e[p-i]+e[p+a]+e[p-a]},t=function(e,t,n,r,i,a,o){var s=-2*e[t]+e[t+r]+e[t-r],c=-2*e[t]+e[t+i]+e[t-i],l=e[t+a]+e[t-a]-e[t+o]-e[t-o],u=Math.sqrt((s-c)*(s-c)+4*l*l)|0;return Math.min(Math.abs(n-u),Math.abs(-(n+u)))};return{laplacian_threshold:30,min_eigen_value_threshold:25,detect:function(r,i,a){a===void 0&&(a=5);var o=0,s=0,c=r.cols,l=r.rows,u=r.data,d=5,f=5*c|0,p=3+3*c|0,m=3-3*c|0,h=n.cache.get_buffer(c*l<<2),g=h.i32,_=0,v=0,y=0,b=0,x,S=0,C=this.laplacian_threshold,w=this.min_eigen_value_threshold,T=Math.max(5,a)|0,E=Math.max(3,a)|0,D=Math.min(c-5,c-a)|0,O=Math.min(l-3,l-a)|0;for(o=c*l;--o>=0;)g[o]=0;for(e(u,g,c,l,d,f,T,E,D,O),v=E*c+T|0,s=E;s<O;++s,v+=c)for(o=T,y=v;o<D;++o,++y)_=g[y],(_<-C&&_<g[y-1]&&_<g[y+1]&&_<g[y-c]&&_<g[y+c]&&_<g[y-c-1]&&_<g[y+c-1]&&_<g[y-c+1]&&_<g[y+c+1]||_>C&&_>g[y-1]&&_>g[y+1]&&_>g[y-c]&&_>g[y+c]&&_>g[y-c-1]&&_>g[y+c-1]&&_>g[y-c+1]&&_>g[y+c+1])&&(b=t(u,y,_,d,f,p,m),b>w&&(x=i[S],x.x=o,x.y=s,x.score=b,++S,++o,++y));return n.cache.put_buffer(h),S}}})()})(n),(function(e){e.yape=(function(){var e=function(e,t,n){var r=0,i=n,a;for(a=0;a<i;a++,r++)i=Math.sqrt(n*n-a*a)+.5|0,t[r]=i+e*a;for(i--;i<a&&i>=0;i--,r++)a=Math.sqrt(n*n-i*i)+.5|0,t[r]=i+e*a;for(;-i<a;i--,r++)a=Math.sqrt(n*n-i*i)+.5|0,t[r]=i+e*a;for(a--;a>=0;a--,r++)i=-Math.sqrt(n*n-a*a)-.5|0,t[r]=i+e*a;for(;a>i;a--,r++)i=-Math.sqrt(n*n-a*a)-.5|0,t[r]=i+e*a;for(i++;i<=0;i++,r++)a=-Math.sqrt(n*n-i*i)-.5|0,t[r]=i+e*a;for(;i<-a;i++,r++)a=-Math.sqrt(n*n-i*i)-.5|0,t[r]=i+e*a;for(a++;a<0;a++,r++)i=Math.sqrt(n*n-a*a)+.5|0,t[r]=i+e*a;return t[r]=t[0],t[r+1]=t[1],r},t=function(e,t,n){var r=0;return e[t+1]!=0&&r++,e[t-1]!=0&&r++,e[t+n]!=0&&r++,e[t+n+1]!=0&&r++,e[t+n-1]!=0&&r++,e[t-n]!=0&&r++,e[t-n+1]!=0&&r++,e[t-n-1]!=0&&r++,r},n=function(e,t,n,r,i){var a,o;if(n>0)for(t-=r*i,o=-i;o<=i;++o){for(a=-i;a<=i;++a)if(e[t+a]>n)return!1;t+=r}else for(t-=r*i,o=-i;o<=i;++o){for(a=-i;a<=i;++a)if(e[t+a]<n)return!1;t+=r}return!0},r=function(e,t,n,r,i,a,o,s){var c=0,l=0,u=o-1|0,d=0,f=0,p=0,m=0,h=0;if(d=e[t+a[l]],d<=i)if(d>=r)if(f=e[t+a[u]],f<=i)if(f>=r){n[t]=0;return}else if(u++,p=e[t+a[u]],p>i)if(u++,m=e[t+a[u]],m>i)h=3;else if(m<r)h=6;else{n[t]=0;return}else if(u++,m=e[t+a[u]],m>i)h=7;else if(m<r)h=2;else{n[t]=0;return}else if(u++,p=e[t+a[u]],p>i)if(u++,m=e[t+a[u]],m>i)h=3;else if(m<r)h=6;else{n[t]=0;return}else if(p<r)if(u++,m=e[t+a[u]],m>i)h=7;else if(m<r)h=2;else{n[t]=0;return}else{n[t]=0;return}else{if(f=e[t+a[u]],f>i){n[t]=0;return}if(u++,p=e[t+a[u]],p>i){n[t]=0;return}if(u++,m=e[t+a[u]],m>i){n[t]=0;return}h=1}else{if(f=e[t+a[u]],f<r){n[t]=0;return}if(u++,p=e[t+a[u]],p<r){n[t]=0;return}if(u++,m=e[t+a[u]],m<r){n[t]=0;return}h=0}for(l=1;l<=o;l++)switch(d=e[t+a[l]],h){case 0:if(d>i){if(p=m,u++,m=e[t+a[u]],m<r){n[t]=0;return}c-=d+p,h=0;break}if(d<r){if(p>i){n[t]=0;return}if(m>i){n[t]=0;return}if(p=m,u++,m=e[t+a[u]],m>i){n[t]=0;return}c-=d+p,h=8;break}if(p<=i){n[t]=0;return}if(m<=i){n[t]=0;return}if(p=m,u++,m=e[t+a[u]],m>i){c-=d+p,h=3;break}if(m<r){c-=d+p,h=6;break}n[t]=0;return;case 1:if(d<r){if(p=m,u++,m=e[t+a[u]],m>i){n[t]=0;return}c-=d+p,h=1;break}if(d>i){if(p<r){n[t]=0;return}if(m<r){n[t]=0;return}if(p=m,u++,m=e[t+a[u]],m<r){n[t]=0;return}c-=d+p,h=9;break}if(p>=r){n[t]=0;return}if(m>=r){n[t]=0;return}if(p=m,u++,m=e[t+a[u]],m<r){c-=d+p,h=2;break}if(m>i){c-=d+p,h=7;break}n[t]=0;return;case 2:if(d>i){n[t]=0;return}if(p=m,u++,m=e[t+a[u]],d<r){if(m>i){n[t]=0;return}c-=d+p,h=4;break}if(m>i){c-=d+p,h=7;break}if(m<r){c-=d+p,h=2;break}n[t]=0;return;case 3:if(d<r){n[t]=0;return}if(p=m,u++,m=e[t+a[u]],d>i){if(m<r){n[t]=0;return}c-=d+p,h=5;break}if(m>i){c-=d+p,h=3;break}if(m<r){c-=d+p,h=6;break}n[t]=0;return;case 4:if(d>i){n[t]=0;return}if(d<r){if(p=m,u++,m=e[t+a[u]],m>i){n[t]=0;return}c-=d+p,h=1;break}if(m>=r){n[t]=0;return}if(p=m,u++,m=e[t+a[u]],m<r){c-=d+p,h=2;break}if(m>i){c-=d+p,h=7;break}n[t]=0;return;case 5:if(d<r){n[t]=0;return}if(d>i){if(p=m,u++,m=e[t+a[u]],m<r){n[t]=0;return}c-=d+p,h=0;break}if(m<=i){n[t]=0;return}if(p=m,u++,m=e[t+a[u]],m>i){c-=d+p,h=3;break}if(m<r){c-=d+p,h=6;break}n[t]=0;return;case 7:if(d>i){n[t]=0;return}if(d<r){n[t]=0;return}if(p=m,u++,m=e[t+a[u]],m>i){c-=d+p,h=3;break}if(m<r){c-=d+p,h=6;break}n[t]=0;return;case 6:if(d>i){n[t]=0;return}if(d<r){n[t]=0;return}if(p=m,u++,m=e[t+a[u]],m<r){c-=d+p,h=2;break}if(m>i){c-=d+p,h=7;break}n[t]=0;return;case 8:if(d>i){if(m<r){n[t]=0;return}if(p=m,u++,m=e[t+a[u]],m<r){n[t]=0;return}c-=d+p,h=9;break}if(d<r){if(p=m,u++,m=e[t+a[u]],m>i){n[t]=0;return}c-=d+p,h=1;break}n[t]=0;return;case 9:if(d<r){if(m>i){n[t]=0;return}if(p=m,u++,m=e[t+a[u]],m>i){n[t]=0;return}c-=d+p,h=8;break}if(d>i){if(p=m,u++,m=e[t+a[u]],m<r){n[t]=0;return}c-=d+p,h=0;break}n[t]=0;return;default:break}n[t]=c+s*e[t]},i=(function(){function t(t,n,r){this.dirs=new Int32Array(1024),this.dirs_count=e(t,this.dirs,r)|0,this.scores=new Int32Array(t*n),this.radius=r|0}return t})();return{level_tables:[],tau:7,init:function(e,t,n,r){r===void 0&&(r=1);var a;for(n=Math.min(n,7),n=Math.max(n,3),a=0;a<r;++a)this.level_tables[a]=new i(e>>a,t>>a,n)},detect:function(e,i,a){a===void 0&&(a=4);var o=this.level_tables[0],s=o.radius|0,c=s-1|0,l=o.dirs,u=o.dirs_count|0,d=u>>1,f=e.data,p=e.cols|0,m=e.rows|0,h=p>>1,g=o.scores,_=0,v=0,y=0,b=0,x=0,S=0,C=0,w=0,T=this.tau|0,E=0,D,O=Math.max(s+1,a)|0,k=Math.max(s+1,a)|0,A=Math.min(p-s-2,p-a)|0,j=Math.min(m-s-2,m-a)|0;for(y=k*p+O|0,v=k;v<j;++v,y+=p)for(_=O,b=y;_<A;++_,++b)x=f[b]+T,S=f[b]-T,S<f[b+s]&&f[b+s]<x&&S<f[b-s]&&f[b-s]<x?g[b]=0:r(f,b,g,S,x,l,d,u);for(y=k*p+O|0,v=k;v<j;++v,y+=p)for(_=O,b=y;_<A;++_,++b)w=g[b],C=Math.abs(w),C<5?(++_,++b):t(g,b,p)>=3&&n(g,b,w,h,s)&&(D=i[E],D.x=_,D.y=v,D.score=C,++E,_+=c,b+=c);return E}}})()})(n),(function(e){e.orb=(function(){var e=new Int32Array([8,-3,9,5,4,2,7,-12,-11,9,-8,2,7,-12,12,-13,2,-13,2,12,1,-7,1,6,-2,-10,-2,-4,-13,-13,-11,-8,-13,-3,-12,-9,10,4,11,9,-13,-8,-8,-9,-11,7,-9,12,7,7,12,6,-4,-5,-3,0,-13,2,-12,-3,-9,0,-7,5,12,-6,12,-1,-3,6,-2,12,-6,-13,-4,-8,11,-13,12,-8,4,7,5,1,5,-3,10,-3,3,-7,6,12,-8,-7,-6,-2,-2,11,-1,-10,-13,12,-8,10,-7,3,-5,-3,-4,2,-3,7,-10,-12,-6,11,5,-12,6,-7,5,-6,7,-1,1,0,4,-5,9,11,11,-13,4,7,4,12,2,-1,4,4,-4,-12,-2,7,-8,-5,-7,-10,4,11,9,12,0,-8,1,-13,-13,-2,-8,2,-3,-2,-2,3,-6,9,-4,-9,8,12,10,7,0,9,1,3,7,-5,11,-10,-13,-6,-11,0,10,7,12,1,-6,-3,-6,12,10,-9,12,-4,-13,8,-8,-12,-13,0,-8,-4,3,3,7,8,5,7,10,-7,-1,7,1,-12,3,-10,5,6,2,-4,3,-10,-13,0,-13,5,-13,-7,-12,12,-13,3,-11,8,-7,12,-4,7,6,-10,12,8,-9,-1,-7,-6,-2,-5,0,12,-12,5,-7,5,3,-10,8,-13,-7,-7,-4,5,-3,-2,-1,-7,2,9,5,-11,-11,-13,-5,-13,-1,6,0,-1,5,-3,5,2,-4,-13,-4,12,-9,-6,-9,6,-12,-10,-8,-4,10,2,12,-3,7,12,12,12,-7,-13,-6,5,-4,9,-3,4,7,-1,12,2,-7,6,-5,1,-13,11,-12,5,-3,7,-2,-6,7,-8,12,-7,-13,-7,-11,-12,1,-3,12,12,2,-6,3,0,-4,3,-2,-13,-1,-13,1,9,7,1,8,-6,1,-1,3,12,9,1,12,6,-1,-9,-1,3,-13,-13,-10,5,7,7,10,12,12,-5,12,9,6,3,7,11,5,-13,6,10,2,-12,2,3,3,8,4,-6,2,6,12,-13,9,-12,10,3,-8,4,-7,9,-11,12,-4,-6,1,12,2,-8,6,-9,7,-4,2,3,3,-2,6,3,11,0,3,-3,8,-8,7,8,9,3,-11,-5,-6,-4,-10,11,-5,10,-5,-8,-3,12,-10,5,-9,0,8,-1,12,-6,4,-6,6,-11,-10,12,-8,7,4,-2,6,7,-2,0,-2,12,-5,-8,-5,2,7,-6,10,12,-9,-13,-8,-8,-5,-13,-5,-2,8,-8,9,-13,-9,-11,-9,0,1,-8,1,-2,7,-4,9,1,-2,1,-1,-4,11,-6,12,-11,-12,-9,-6,4,3,7,7,12,5,5,10,8,0,-4,2,8,-9,12,-5,-13,0,7,2,12,-1,2,1,7,5,11,7,-9,3,5,6,-8,-13,-4,-8,9,-5,9,-3,-3,-4,-7,-3,-12,6,5,8,0,-7,6,-6,12,-13,6,-5,-2,1,-10,3,10,4,1,8,-4,-2,-2,2,-13,2,-12,12,12,-2,-13,0,-6,4,1,9,3,-6,-10,-3,-5,-3,-13,-1,1,7,5,12,-11,4,-2,5,-7,-13,9,-9,-5,7,1,8,6,7,-8,7,6,-7,-4,-7,1,-8,11,-7,-8,-13,6,-12,-8,2,4,3,9,10,-5,12,3,-6,-5,-6,7,8,-3,9,-8,2,-12,2,8,-11,-2,-10,3,-12,-13,-7,-9,-11,0,-10,-5,5,-3,11,8,-2,-13,-1,12,-1,-8,0,9,-13,-11,-12,-5,-10,-2,-10,11,-3,9,-2,-13,2,-3,3,2,-9,-13,-4,0,-4,6,-3,-10,-4,12,-2,-7,-6,-11,-4,9,6,-3,6,11,-13,11,-5,5,11,11,12,6,7,-5,12,-2,-1,12,0,7,-4,-8,-3,-2,-7,1,-6,7,-13,-12,-8,-13,-7,-2,-6,-8,-8,5,-6,-9,-5,-1,-4,5,-13,7,-8,10,1,5,5,-13,1,0,10,-13,9,12,10,-1,5,-8,10,-9,-1,11,1,-13,-9,-3,-6,2,-1,-10,1,12,-13,1,-8,-10,8,-11,10,-6,2,-13,3,-6,7,-13,12,-9,-10,-10,-5,-7,-10,-8,-8,-13,4,-6,8,5,3,12,8,-13,-4,2,-3,-3,5,-13,10,-12,4,-13,5,-1,-9,9,-4,3,0,3,3,-9,-12,1,-6,1,3,2,4,-8,-10,-10,-10,9,8,-13,12,12,-8,-12,-6,-5,2,2,3,7,10,6,11,-8,6,8,8,-12,-7,10,-6,5,-3,-9,-3,9,-1,-13,-1,5,-3,-7,-3,4,-8,-2,-8,3,4,2,12,12,2,-5,3,11,6,-9,11,-13,3,-1,7,12,11,-1,12,4,-3,0,-3,6,4,-11,4,12,2,-4,2,1,-10,-6,-8,1,-13,7,-11,1,-13,12,-11,-13,6,0,11,-13,0,-1,1,4,-13,3,-9,-2,-9,8,-6,-3,-13,-6,-8,-2,5,-9,8,10,2,7,3,-9,-1,-6,-1,-1,9,5,11,-2,11,-3,12,-8,3,0,3,5,-1,4,0,10,3,-6,4,5,-13,0,-10,5,5,8,12,11,8,9,9,-6,7,-4,8,-12,-10,4,-10,9,7,3,12,4,9,-7,10,-2,7,0,12,-2,-1,-6,0,-11]),t=new n.matrix_t(3,3,n.F32_t|n.C1_t),r=new n.matrix_t(32,32,n.U8_t|n.C1_t),i=function(e,r,i,a,o,s){var c=Math.cos(i),l=Math.sin(i);t.data[0]=c,t.data[1]=-l,t.data[2]=(-c+l)*s*.5+a,t.data[3]=l,t.data[4]=c,t.data[5]=(-l-c)*s*.5+o,n.imgproc.warp_affine(e,r,t,128)};return{describe:function(t,a,o,s){var c=32,l=0,u=0,d=0,f=0,p=0,m=0,h=0,g=0;t.data,t.cols,t.rows;var _=r.data,v=528,y=0;s.type&n.U8_t?s.resize(c,o,1):(s.type=n.U8_t,s.cols=c,s.rows=o,s.channel=1,s.allocate());var b=s.data,x=0;for(l=0;l<o;++l){for(d=a[l].x,f=a[l].y,p=a[l].angle,i(t,r,p,d,f,32),y=0,u=0;u<c;++u)m=_[v+e[y+1]*32+e[y]],y+=2,h=_[v+e[y+1]*32+e[y]],y+=2,g=m<h|0,m=_[v+e[y+1]*32+e[y]],y+=2,h=_[v+e[y+1]*32+e[y]],y+=2,g|=(m<h)<<1,m=_[v+e[y+1]*32+e[y]],y+=2,h=_[v+e[y+1]*32+e[y]],y+=2,g|=(m<h)<<2,m=_[v+e[y+1]*32+e[y]],y+=2,h=_[v+e[y+1]*32+e[y]],y+=2,g|=(m<h)<<3,m=_[v+e[y+1]*32+e[y]],y+=2,h=_[v+e[y+1]*32+e[y]],y+=2,g|=(m<h)<<4,m=_[v+e[y+1]*32+e[y]],y+=2,h=_[v+e[y+1]*32+e[y]],y+=2,g|=(m<h)<<5,m=_[v+e[y+1]*32+e[y]],y+=2,h=_[v+e[y+1]*32+e[y]],y+=2,g|=(m<h)<<6,m=_[v+e[y+1]*32+e[y]],y+=2,h=_[v+e[y+1]*32+e[y]],y+=2,g|=(m<h)<<7,b[x+u]=g;x+=c}}}})()})(n),(function(e){e.optical_flow_lk=(function(){var e=n.imgproc.scharr_derivatives;return{track:function(t,r,i,a,o,s,c,l,u,d){c===void 0&&(c=30),l===void 0&&(l=new Uint8Array(o)),u===void 0&&(u=.01),d===void 0&&(d=1e-4);var f=(s-1)*.5,p=s*s|0,m=p<<1,h=t.data,g=r.data,_=h[0].data,v=g[0].data,y=h[0].cols,b=h[0].rows,x=0,S=0,C=n.cache.get_buffer(p<<2),w=n.cache.get_buffer(m<<2),T=n.cache.get_buffer(b*(y<<1)<<2),E=new n.matrix_t(y,b,n.S32C2_t,T.data),D=C.i32,O=w.i32,k=T.i32,A=0,j=0,M=0,N=0,P=0,F=0,I=0,L=0,R=0,z=0,B=0,V=0,H=0,U=0,W=0,G=0,K=0,ee=0,q=0,te=0,ne=0,re=0,ie=0,J=0,ae=0,oe=0,se=0,ce=0,le=0,ue=0,Y=0,X=0,de=0,Z=14,Q=14,fe=Q-5,pe=1<<fe-1,me=1<<Z,he=1<<Q-1,ge=1/(1<<20),_e=0,$=0,ve=0,ye=0,be=0,xe=0,Se=0,Ce=0,we=0,Te=0,Ee=0,De=0,Oe=1.1920929e-7;for(u*=u;te<o;++te)l[te]=1;var ke=t.levels-1|0;for(J=ke;J>=0;--J)for(I=1/(1<<J),x=y>>J,S=b>>J,A=x<<1,_=h[J].data,v=g[J].data,ce=x-s|0,le=S-s|0,e(h[J],E),ae=0;ae<o;++ae){if(te=ae<<1,ne=te+1,L=i[te]*I,R=i[ne]*I,J==ke?(z=L,B=R):(z=a[te]*2,B=a[ne]*2),a[te]=z,a[ne]=B,L-=f,R-=f,G=L|0,K=R|0,re=G<=se|G>=ce|K<=se|K>=le,re!=0){J==0&&(l[ae]=0);continue}for(ue=L-G,Y=R-K,_e=(1-ue)*(1-Y)*me+.5|0,$=ue*(1-Y)*me+.5|0,ve=(1-ue)*Y*me+.5|0,ye=me-_e-$-ve,Ce=0,we=0,Te=0,ie=0;ie<s;++ie)for(j=(ie+K)*x+G|0,M=j<<1,N=ie*s|0,P=N<<1,re=0;re<s;++re,++j,++N,M+=2)be=_[j]*_e+_[j+1]*$+_[j+x]*ve+_[j+x+1]*ye,be=be+pe>>fe,xe=k[M]*_e+k[M+2]*$+k[M+A]*ve+k[M+A+2]*ye,xe=xe+he>>Q,Se=k[M+1]*_e+k[M+3]*$+k[M+A+1]*ve+k[M+A+3]*ye,Se=Se+he>>Q,D[N]=be,O[P++]=xe,O[P++]=Se,Ce+=xe*xe,we+=xe*Se,Te+=Se*Se;if(Ce*=ge,we*=ge,Te*=ge,Ee=Ce*Te-we*we,De=(Te+Ce-Math.sqrt((Ce-Te)*(Ce-Te)+4*we*we))/m,De<d||Ee<Oe){J==0&&(l[ae]=0);continue}for(Ee=1/Ee,z-=f,B-=f,V=0,H=0,oe=0;oe<c;++oe){if(ee=z|0,q=B|0,re=ee<=se|ee>=ce|q<=se|q>=le,re!=0){J==0&&(l[ae]=0);break}for(ue=z-ee,Y=B-q,_e=(1-ue)*(1-Y)*me+.5|0,$=ue*(1-Y)*me+.5|0,ve=(1-ue)*Y*me+.5|0,ye=me-_e-$-ve,X=0,de=0,ie=0;ie<s;++ie)for(F=(ie+q)*x+ee|0,N=ie*s|0,P=N<<1,re=0;re<s;++re,++F,++N)be=v[F]*_e+v[F+1]*$+v[F+x]*ve+v[F+x+1]*ye,be=be+pe>>fe,be-=D[N],X+=be*O[P++],de+=be*O[P++];if(X*=ge,de*=ge,U=(we*de-Te*X)*Ee,W=(we*X-Ce*de)*Ee,z+=U,B+=W,a[te]=z+f,a[ne]=B+f,U*U+W*W<=u)break;if(oe>0&&Math.abs(U+V)<.01&&Math.abs(W+H)<.01){a[te]-=U*.5,a[ne]-=W*.5;break}V=U,H=W}}n.cache.put_buffer(C),n.cache.put_buffer(w),n.cache.put_buffer(T)}}})()})(n),(function(e){e.haar=(function(){var e=function(e,t){var n=e.width*.25+.5|0;return t.x<=e.x+n&&t.x>=e.x-n&&t.y<=e.y+n&&t.y>=e.y-n&&t.width<=e.width*1.5+.5|0&&t.width*1.5+.5|0>=e.width};return{edges_density:.07,detect_single_scale:function(e,t,n,r,i,a,o,s){var c=s.size[0]*o|0,l=s.size[1]*o|0,u=.5*o+1.5|0,d=u,f,p,m,h,g,_=i-c|0,v=a-l|0,y=i+1|0,b,x,S,C,w=1/(c*l),T,E,D,O,k,A,j,M=!0,N,P,F,I,L,R,z,B,V,H,U=0,W=c,G=l*y,K=G+c,ee=c*l*255*this.edges_density|0,q=[];for(g=0;g<v;g+=d)for(U=g*y,h=0;h<_;h+=u,U+=u){if(x=e[U]-e[U+W]-e[U+G]+e[U+K],r&&(b=r[U]-r[U+W]-r[U+G]+r[U+K],b<ee||x<20)){h+=u,U+=u;continue}for(x*=w,S=(t[U]-t[U+W]-t[U+G]+t[U+K])*w-x*x,C=S>0?Math.sqrt(S):1,T=s.complexClassifiers,k=T.length,M=!0,f=0;f<k;++f){for(E=T[f],N=E.threshold,D=E.simpleClassifiers,A=D.length,P=0,p=0;p<A;++p){if(O=D[p],F=0,L=O.features,j=L.length,O.tilted===1)for(m=0;m<j;++m)I=L[m],R=~~(h+I[0]*o)+~~(g+I[1]*o)*y,V=~~(I[2]*o),H=~~(I[3]*o),z=V*y,B=H*y,F+=(n[R]-n[R+V+z]-n[R-H+B]+n[R+V-H+z+B])*I[4];else for(m=0;m<j;++m)I=L[m],R=~~(h+I[0]*o)+~~(g+I[1]*o)*y,V=~~(I[2]*o),H=~~(I[3]*o),B=H*y,F+=(e[R]-e[R+V]-e[R+B]+e[R+B+V])*I[4];P+=F*w<O.threshold*C?O.left_val:O.right_val}if(P<N){M=!1;break}}M&&(q.push({x:h,y:g,width:c,height:l,neighbor:1,confidence:P}),h+=u,U+=u)}return q},detect_multi_scale:function(e,t,n,r,i,a,o,s,c){s===void 0&&(s=1.2),c===void 0&&(c=1);for(var l=o.size[0],u=o.size[1],d=[];c*l<i&&c*u<a;)d=d.concat(this.detect_single_scale(e,t,n,r,i,a,c,o)),c*=s;return d},group_rectangles:function(t,n){n===void 0&&(n=1);var r,i,a=t.length,o=[];for(r=0;r<a;++r)o[r]={parent:-1,element:t[r],rank:0};for(r=0;r<a;++r)if(o[r].element){for(var s=r;o[s].parent!=-1;)s=o[s].parent;for(i=0;i<a;++i)if(r!=i&&o[i].element&&e(o[r].element,o[i].element)){for(var c=i;o[c].parent!=-1;)c=o[c].parent;if(c!=s){o[s].rank>o[c].rank?o[c].parent=s:(o[s].parent=c,o[s].rank==o[c].rank&&o[c].rank++,s=c);for(var l,u=i;o[u].parent!=-1;)l=u,u=o[u].parent,o[l].parent=s;for(u=r;o[u].parent!=-1;)l=u,u=o[u].parent,o[l].parent=s}}}var d=[],f=0;for(r=0;r<a;r++){i=-1;var p=r;if(o[p].element){for(;o[p].parent!=-1;)p=o[p].parent;o[p].rank>=0&&(o[p].rank=~f++),i=~o[p].rank}d[r]=i}var m=[];for(r=0;r<f+1;++r)m[r]={neighbors:0,x:0,y:0,width:0,height:0,confidence:0};for(r=0;r<a;++r){var h=t[r],g=d[r];m[g].neighbors==0&&(m[g].confidence=h.confidence),++m[g].neighbors,m[g].x+=h.x,m[g].y+=h.y,m[g].width+=h.width,m[g].height+=h.height,m[g].confidence=Math.max(m[g].confidence,h.confidence)}var _=[];for(r=0;r<f;++r)a=m[r].neighbors,a>=n&&_.push({x:(m[r].x*2+a)/(2*a),y:(m[r].y*2+a)/(2*a),width:(m[r].width*2+a)/(2*a),height:(m[r].height*2+a)/(2*a),neighbors:m[r].neighbors,confidence:m[r].confidence});var v=[];for(a=_.length,r=0;r<a;++r){var h=_[r],y=!0;for(i=0;i<a;++i){var b=_[i],x=b.width*.25+.5|0;if(r!=i&&h.x>=b.x-x&&h.y>=b.y-x&&h.x+h.width<=b.x+b.width+x&&h.y+h.height<=b.y+b.height+x&&(b.neighbors>Math.max(3,h.neighbors)||h.neighbors<3)){y=!1;break}}y&&v.push(h)}return v}}})()})(n),(function(e){e.bbf=(function(){var e=function(e,t){var n=e.width*.25+.5|0;return t.x<=e.x+n&&t.x>=e.x-n&&t.y<=e.y+n&&t.y>=e.y-n&&t.width<=e.width*1.5+.5|0&&t.width*1.5+.5|0>=e.width},t=new n.pyramid_t(1);return{interval:4,scale:1.1486,next:5,scale_to:1,prepare_cascade:function(e){for(var t=e.stage_classifier.length,n=0;n<t;n++)for(var r=e.stage_classifier[n].feature,i=e.stage_classifier[n].count,a=e.stage_classifier[n]._feature=Array(i),o=0;o<i;o++)a[o]={size:r[o].size,px:Array(r[o].size),pz:Array(r[o].size),nx:Array(r[o].size),nz:Array(r[o].size)}},build_pyramid:function(e,r,i,a){a===void 0&&(a=4);var o=e.cols,s=e.rows,c=0,l=0,u=0,d=!1,f=e,p=e,m=n.U8_t|n.C1_t;this.interval=a,this.scale=2**(1/(this.interval+1)),this.next=this.interval+1|0,this.scale_to=Math.log(Math.min(o/r,s/i))/Math.log(this.scale)|0;var h=(this.scale_to+this.next*2)*4|0;for(t.levels!=h&&(t.levels=h,t.data=Array(h),d=!0,t.data[0]=e),c=1;c<=this.interval;++c)l=o/this.scale**+c|0,u=s/this.scale**+c|0,f=t.data[c<<2],(d||l!=f.cols||u!=f.rows)&&(t.data[c<<2]=new n.matrix_t(l,u,m),f=t.data[c<<2]),n.imgproc.resample(e,f,l,u);for(c=this.next;c<this.scale_to+this.next*2;++c)p=t.data[(c<<2)-(this.next<<2)],f=t.data[c<<2],l=p.cols>>1,u=p.rows>>1,(d||l!=f.cols||u!=f.rows)&&(t.data[c<<2]=new n.matrix_t(l,u,m),f=t.data[c<<2]),n.imgproc.pyrdown(p,f);for(c=this.next*2;c<this.scale_to+this.next*2;++c)p=t.data[(c<<2)-(this.next<<2)],l=p.cols>>1,u=p.rows>>1,f=t.data[(c<<2)+1],(d||l!=f.cols||u!=f.rows)&&(t.data[(c<<2)+1]=new n.matrix_t(l,u,m),f=t.data[(c<<2)+1]),n.imgproc.pyrdown(p,f,1,0),f=t.data[(c<<2)+2],(d||l!=f.cols||u!=f.rows)&&(t.data[(c<<2)+2]=new n.matrix_t(l,u,m),f=t.data[(c<<2)+2]),n.imgproc.pyrdown(p,f,0,1),f=t.data[(c<<2)+3],(d||l!=f.cols||u!=f.rows)&&(t.data[(c<<2)+3]=new n.matrix_t(l,u,m),f=t.data[(c<<2)+3]),n.imgproc.pyrdown(p,f,1,1);return t},detect:function(e,t){this.interval;var n=this.scale,r=this.next,i=this.scale_to,a=0,o=0,s=0,c=0,l=0,u=0,d=0,f=0,p=0,m=0,h=0,g=0,_=0,v=0,y=0,b=0,x=0,S=0,C,w,T,E,D,O=!0,k=!0,A=1,j=1,M=[0,1,0,1],N=[0,0,1,1],P=[],F=e.data,I=1,L=2,R=4,z=[],B=[0,0,0],V=[0,0,0],H=[0,0,0];for(a=0;a<i;a++){for(y=a<<2,b=F[y+(r<<3)].cols-(t.width>>2),x=F[y+(r<<3)].rows-(t.height>>2),V[0]=F[y].cols*I,V[1]=F[y+(r<<2)].cols*I,V[2]=F[y+(r<<3)].cols*I,H[0]=F[y].cols*R-b*R,H[1]=F[y+(r<<2)].cols*L-b*L,H[2]=F[y+(r<<3)].cols*I-b*I,f=t.stage_classifier.length,o=0;o<f;o++)for(T=t.stage_classifier[o].feature,w=t.stage_classifier[o]._feature,p=t.stage_classifier[o].count,s=0;s<p;s++)for(E=w[s],D=T[s],m=D.size|0,d=0;d<m;d++)E.px[d]=D.px[d]*I+D.py[d]*V[D.pz[d]],E.pz[d]=D.pz[d],E.nx[d]=D.nx[d]*I+D.ny[d]*V[D.nz[d]],E.nz[d]=D.nz[d];for(z[0]=F[y].data,z[1]=F[y+(r<<2)].data,d=0;d<4;d++)for(z[2]=F[y+(r<<3)+d].data,B[0]=M[d]*L+N[d]*(F[y].cols*L),B[1]=M[d]*I+N[d]*(F[y+(r<<2)].cols*I),B[2]=0,u=0;u<x;u++){for(l=0;l<b;l++){for(S=0,O=!0,f=t.stage_classifier.length,o=0;o<f;o++){for(S=0,C=t.stage_classifier[o].alpha,w=t.stage_classifier[o]._feature,p=t.stage_classifier[o].count,s=0;s<p;s++)if(E=w[s],g=z[E.pz[0]][B[E.pz[0]]+E.px[0]],_=z[E.nz[0]][B[E.nz[0]]+E.nx[0]],g<=_)S+=C[s<<1];else{for(k=!0,m=E.size,v=1;v<m;v++){if(E.pz[v]>=0&&(h=z[E.pz[v]][B[E.pz[v]]+E.px[v]],h<g)){if(h<=_){k=!1;break}g=h}if(E.nz[v]>=0&&(c=z[E.nz[v]][B[E.nz[v]]+E.nx[v]],c>_)){if(g<=c){k=!1;break}_=c}}S+=k?C[(s<<1)+1]:C[s<<1]}if(S<t.stage_classifier[o].threshold){O=!1;break}}O&&(P.push({x:(l*4+M[d]*2)*A,y:(u*4+N[d]*2)*j,width:t.width*A,height:t.height*j,neighbor:1,confidence:S}),++l,B[0]+=R,B[1]+=L,B[2]+=I),B[0]+=R,B[1]+=L,B[2]+=I}B[0]+=H[0],B[1]+=H[1],B[2]+=H[2]}A*=n,j*=n}return P},group_rectangles:function(t,n){n===void 0&&(n=1);var r,i,a=t.length,o=[];for(r=0;r<a;++r)o[r]={parent:-1,element:t[r],rank:0};for(r=0;r<a;++r)if(o[r].element){for(var s=r;o[s].parent!=-1;)s=o[s].parent;for(i=0;i<a;++i)if(r!=i&&o[i].element&&e(o[r].element,o[i].element)){for(var c=i;o[c].parent!=-1;)c=o[c].parent;if(c!=s){o[s].rank>o[c].rank?o[c].parent=s:(o[s].parent=c,o[s].rank==o[c].rank&&o[c].rank++,s=c);for(var l,u=i;o[u].parent!=-1;)l=u,u=o[u].parent,o[l].parent=s;for(u=r;o[u].parent!=-1;)l=u,u=o[u].parent,o[l].parent=s}}}var d=[],f=0;for(r=0;r<a;r++){i=-1;var p=r;if(o[p].element){for(;o[p].parent!=-1;)p=o[p].parent;o[p].rank>=0&&(o[p].rank=~f++),i=~o[p].rank}d[r]=i}var m=[];for(r=0;r<f+1;++r)m[r]={neighbors:0,x:0,y:0,width:0,height:0,confidence:0};for(r=0;r<a;++r){var h=t[r],g=d[r];m[g].neighbors==0&&(m[g].confidence=h.confidence),++m[g].neighbors,m[g].x+=h.x,m[g].y+=h.y,m[g].width+=h.width,m[g].height+=h.height,m[g].confidence=Math.max(m[g].confidence,h.confidence)}var _=[];for(r=0;r<f;++r)a=m[r].neighbors,a>=n&&_.push({x:(m[r].x*2+a)/(2*a),y:(m[r].y*2+a)/(2*a),width:(m[r].width*2+a)/(2*a),height:(m[r].height*2+a)/(2*a),neighbors:m[r].neighbors,confidence:m[r].confidence});var v=[];for(a=_.length,r=0;r<a;++r){var h=_[r],y=!0;for(i=0;i<a;++i){var b=_[i],x=b.width*.25+.5|0;if(r!=i&&h.x>=b.x-x&&h.y>=b.y-x&&h.x+h.width<=b.x+b.width+x&&h.y+h.height<=b.y+b.height+x&&(b.neighbors>Math.max(3,h.neighbors)||h.neighbors<3)){y=!1;break}}y&&v.push(h)}return v}}})()})(n),(function(e){t===void 0||t.exports===void 0?window.jsfeat=e:t.exports=e})(n)})),ce=oe(),le=u(se(),1),ue=document.querySelector(`#app`);ue.innerHTML=`
  <div class="app-container">
    <header>
      <h1> Document Scanner</h1>
      <p class="subtitle">Scan, detect, and extract text</p>
    </header>
    
    <div class="scanner-area">
      <div class="video-container">
        <video id="video" autoplay playsinline></video>
        <canvas id="canvas"></canvas>
      </div>
      
      <div class="controls">
        <button id="swap" class="btn btn-secondary"> Switch Camera</button>
        <button id="capture" class="btn btn-primary"> Capture</button>
      </div>
    </div>
    
    <div class="editor-area" id="editorArea" style="display:none;">
      <div class="canvas-wrapper">
        <canvas id="editCanvas"></canvas>
      </div>
      
      <div class="editor-controls">
        <button id="retake" class="btn btn-secondary"> Retake</button>
        <button id="crop" class="btn btn-primary"> Crop & Correct</button>
      </div>
      
      <div class="filter-controls">
        <label>Filters:</label>
        <button id="filterNone" class="btn-filter active">Original</button>
        <button id="filterGray" class="btn-filter">Grayscale</button>
        <button id="filterBW" class="btn-filter">Black & White</button>
        <button id="filterEnhance" class="btn-filter">Enhanced</button>
      </div>
    </div>
    
    <div class="result-area" id="resultArea" style="display:none;">
      <button id="processOCR" class="btn btn-primary btn-large"> Extract Text (OCR)</button>
      <div id="ocrProgress" style="display:none;" class="progress-bar">
        <div class="progress-fill"></div>
        <span class="progress-text">Processing...</span>
      </div>
      <textarea id="result" placeholder="Extracted text will appear here..."></textarea>
      <div class="result-controls">
        <button id="copyText" class="btn btn-secondary"> Copy</button>
        <button id="downloadImage" class="btn btn-secondary"> Download</button>
        <button id="newScan" class="btn btn-primary"> New Scan</button>
      </div>
    </div>
  </div>
`;var Y=document.getElementById(`video`),X=document.getElementById(`canvas`),de=X.getContext(`2d`),Z=document.getElementById(`editCanvas`),Q=Z.getContext(`2d`),fe=document.getElementById(`swap`),pe=document.getElementById(`capture`),me=document.getElementById(`retake`),he=document.getElementById(`crop`),ge=document.getElementById(`processOCR`),_e=document.getElementById(`copyText`),$=document.getElementById(`downloadImage`),ve=document.getElementById(`newScan`),ye=document.getElementById(`filterNone`),be=document.getElementById(`filterGray`),xe=document.getElementById(`filterBW`),Se=document.getElementById(`filterEnhance`),Ce=document.getElementById(`editorArea`),we=document.getElementById(`resultArea`),Te=document.getElementById(`ocrProgress`),Ee=document.getElementById(`result`),De=`environment`,Oe=[],ke=null,Ae=null,je=null;async function Me(e){try{Y.srcObject=await navigator.mediaDevices.getUserMedia({video:{facingMode:{ideal:e},width:{ideal:1280},height:{ideal:720}}}),Y.onloadedmetadata=()=>{X.width=Y.videoWidth,X.height=Y.videoHeight}}catch(e){console.error(`Camera error:`,e),alert(`Could not access camera. Please check permissions.`)}}Me(De),fe.addEventListener(`click`,async()=>{Y.srcObject&&Y.srcObject.getTracks().forEach(e=>e.stop()),De=De===`environment`?`user`:`environment`,await Me(De)}),pe.addEventListener(`click`,()=>{X.width=Y.videoWidth,X.height=Y.videoHeight,de.drawImage(Y,0,0),Ae=de.getImageData(0,0,X.width,X.height),Ne(),Z.width=X.width,Z.height=X.height,Pe(),document.querySelector(`.scanner-area`).style.display=`none`,Ce.style.display=`block`});function Ne(){let e=Ae,t=X.width,n=X.height,r=new le.default.matrix_t(t,n,le.default.U8_t|le.default.C1_t);for(let t=0,n=0;t<e.data.length;t+=4,n++)r.data[n]=e.data[t]*.299+e.data[t+1]*.587+e.data[t+2]*.114|0;le.default.imgproc.canny(r,r,50,100);let i=t,a=n,o=0,s=0;for(let e=0;e<n;e++)for(let n=0;n<t;n++)r.data[e*t+n]>100&&(i=Math.min(i,n),a=Math.min(a,e),o=Math.max(o,n),s=Math.max(s,e));Oe=[{x:Math.max(20,i),y:Math.max(20,a)},{x:Math.min(t-20,o),y:Math.max(20,a)},{x:Math.min(t-20,o),y:Math.min(n-20,s)},{x:Math.max(20,i),y:Math.min(n-20,s)}]}function Pe(){Q.putImageData(Ae,0,0),Q.strokeStyle=`#4CAF50`,Q.lineWidth=3,Q.beginPath(),Q.moveTo(Oe[0].x,Oe[0].y);for(let e=1;e<4;e++)Q.lineTo(Oe[e].x,Oe[e].y);Q.closePath(),Q.stroke(),Oe.forEach((e,t)=>{Q.fillStyle=`#ff5722`,Q.fillRect(e.x-8,e.y-8,16,16),Q.fillStyle=`white`,Q.font=`12px bold Arial`,Q.textAlign=`center`,Q.fillText(t+1,e.x,e.y+4)})}var Fe=!1;Z.addEventListener(`mousedown`,e=>{let t=Z.getBoundingClientRect(),n=(e.clientX-t.left)*(Z.width/t.width),r=(e.clientY-t.top)*(Z.height/t.height);for(let e=0;e<Oe.length;e++)if(Math.hypot(n-Oe[e].x,r-Oe[e].y)<20){ke=e,Fe=!0;break}}),Z.addEventListener(`mousemove`,e=>{if(!Fe||ke===null)return;let t=Z.getBoundingClientRect(),n=(e.clientX-t.left)*(Z.width/t.width),r=(e.clientY-t.top)*(Z.height/t.height);Oe[ke]={x:Math.max(0,Math.min(n,Z.width)),y:Math.max(0,Math.min(r,Z.height))},Pe()}),Z.addEventListener(`mouseup`,()=>{Fe=!1,ke=null}),Z.addEventListener(`touchstart`,e=>{e.preventDefault();let t=e.touches[0],n=Z.getBoundingClientRect(),r=(t.clientX-n.left)*(Z.width/n.width),i=(t.clientY-n.top)*(Z.height/n.height);for(let e=0;e<Oe.length;e++)if(Math.hypot(r-Oe[e].x,i-Oe[e].y)<30){ke=e,Fe=!0;break}}),Z.addEventListener(`touchmove`,e=>{if(e.preventDefault(),!Fe||ke===null)return;let t=e.touches[0],n=Z.getBoundingClientRect(),r=(t.clientX-n.left)*(Z.width/n.width),i=(t.clientY-n.top)*(Z.height/n.height);Oe[ke]={x:Math.max(0,Math.min(r,Z.width)),y:Math.max(0,Math.min(i,Z.height))},Pe()}),Z.addEventListener(`touchend`,()=>{Fe=!1,ke=null}),he.addEventListener(`click`,()=>{let[e,t,n,r]=Oe,i=Math.hypot(t.x-e.x,t.y-e.y),a=Math.hypot(n.x-r.x,n.y-r.y),o=Math.hypot(r.x-e.x,r.y-e.y),s=Math.hypot(n.x-t.x,n.y-t.y),c=Math.round(Math.max(i,a)),l=Math.round(Math.max(o,s)),u=document.createElement(`canvas`);u.width=c,u.height=l;let d=u.getContext(`2d`),f=Q.getImageData(0,0,Z.width,Z.height),p=d.createImageData(c,l);for(let i=0;i<l;i++)for(let a=0;a<c;a++){let o=a/c,s=i/l,u=e.x*(1-o)*(1-s)+t.x*o*(1-s)+n.x*o*s+r.x*(1-o)*s,d=e.y*(1-o)*(1-s)+t.y*o*(1-s)+n.y*o*s+r.y*(1-o)*s,m=Math.round(u),h=Math.round(d);if(m>=0&&m<Z.width&&h>=0&&h<Z.height){let e=(h*Z.width+m)*4,t=(i*c+a)*4;p.data[t]=f.data[e],p.data[t+1]=f.data[e+1],p.data[t+2]=f.data[e+2],p.data[t+3]=255}}d.putImageData(p,0,0),Z.width=c,Z.height=l,Q.drawImage(u,0,0),je=Q.getImageData(0,0,c,l),Ce.style.display=`none`,we.style.display=`block`});function Ie(e){if(!je)return;let t=new ImageData(new Uint8ClampedArray(je.data),je.width,je.height);for(let n=0;n<t.data.length;n+=4){let r=t.data[n],i=t.data[n+1],a=t.data[n+2];if(e===`gray`){let e=.299*r+.587*i+.114*a;t.data[n]=t.data[n+1]=t.data[n+2]=e}else if(e===`bw`){let e=.299*r+.587*i+.114*a>128?255:0;t.data[n]=t.data[n+1]=t.data[n+2]=e}else if(e===`enhance`){let e=1.5;t.data[n]=Math.min(255,(r-128)*e+128),t.data[n+1]=Math.min(255,(i-128)*e+128),t.data[n+2]=Math.min(255,(a-128)*e+128)}}Q.putImageData(t,0,0),je=t}ye.addEventListener(`click`,()=>{document.querySelectorAll(`.btn-filter`).forEach(e=>e.classList.remove(`active`)),ye.classList.add(`active`),je&&Q.putImageData(new ImageData(new Uint8ClampedArray(je.data),je.width,je.height),0,0)}),be.addEventListener(`click`,()=>{document.querySelectorAll(`.btn-filter`).forEach(e=>e.classList.remove(`active`)),be.classList.add(`active`),Ie(`gray`)}),xe.addEventListener(`click`,()=>{document.querySelectorAll(`.btn-filter`).forEach(e=>e.classList.remove(`active`)),xe.classList.add(`active`),Ie(`bw`)}),Se.addEventListener(`click`,()=>{document.querySelectorAll(`.btn-filter`).forEach(e=>e.classList.remove(`active`)),Se.classList.add(`active`),Ie(`enhance`)}),me.addEventListener(`click`,()=>{Ce.style.display=`none`,document.querySelector(`.scanner-area`).style.display=`block`}),ge.addEventListener(`click`,async()=>{Te.style.display=`block`,ge.disabled=!0;try{let e=await(0,ce.createWorker)(`eng+chi_tra`,1,{logger:e=>console.log(e)}),{data:{text:t}}=await e.recognize(Z);await e.terminate(),Ee.value=t,Te.style.display=`none`,ge.disabled=!1}catch(e){alert(`OCR failed: `+e.message),Te.style.display=`none`,ge.disabled=!1}}),_e.addEventListener(`click`,()=>{Ee.select(),document.execCommand(`copy`),_e.textContent=` Copied!`,setTimeout(()=>_e.textContent=` Copy`,2e3)}),$.addEventListener(`click`,()=>{let e=document.createElement(`a`);e.download=`scan-${Date.now()}.png`,e.href=Z.toDataURL(),e.click()}),ve.addEventListener(`click`,()=>{we.style.display=`none`,document.querySelector(`.scanner-area`).style.display=`block`,Ee.value=``,je=null,Ae=null});